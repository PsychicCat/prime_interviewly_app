var app = angular.module('app', ['ngMaterial', 'ngRoute', 'ngMessages', 'ui.grid', 'ui.grid.edit', 'ui.grid.rowEdit', 'ui.grid.exporter']);


// Angular routing
app.config(['$routeProvider', '$locationProvider', '$mdThemingProvider', function($routeProvider, $locationProvider, $mdThemingProvider){


    $mdThemingProvider.theme('default')
        .primaryPalette('blue-grey')
        .accentPalette('orange');


    $locationProvider.html5Mode({
        enabled: true
    });
    $routeProvider.
        when('/home', {
            templateUrl: 'views/partials/home/home.html'
        }).
        when('/', {
            templateUrl: 'views/partials/account/login/login.html'
        }).
        when('/forgot', {
            templateUrl: 'views/partials/account/forgot/forgot.html'
        }).
        when('/events', {
            templateUrl: 'views/partials/events/events.html'
        }).
        when('/students', {
            templateUrl: 'views/partials/students/students.html'
        }).
        when('/interviewers', {
            templateUrl: 'views/partials/interviewers/interviewers.html'
        }).
        when('/archived-events', {
            templateUrl: 'views/partials/events/archived-events/archived-events.html'
        }).
        when('/profile', {
            templateUrl: 'views/partials/account/profile/profile.html'
        }).
        when('/logout', {
            templateUrl: 'views/partials/account/logout/logout.html'
        }).
        when('/new-event', {
            templateUrl: 'views/partials/events/new-event/new-event.html'
        }).
        when('/reset/:token', {
            templateUrl: 'views/partials/account/reset/reset.html',
            controller: 'reset'
        }).
        otherwise({
            redirectTo: '/'
    })
}]);

/*
Toolbar controller
 */
app.controller('toolbar', ['$rootScope','$location','$scope', '$window', function($rootScope, $location, $scope, $window){
    $scope.paths = true;
    $rootScope.$on('logged In', function(){
        if($window.sessionStorage.token == undefined){
            $scope.paths = true;
        }else{
            $scope.paths = false;
            $scope.user = {
                username: $window.sessionStorage.username.replace(/^"(.*)"$/, '$1')
            };
        }
    });
    $scope.goHome = function(){
        $location.path('/');
    }
}]);

/*
Directive to check the passwords are the same
 */
app.directive('verifySame', function(){
       return {
           require: "ngModel",
           scope: {
               otherModelValue: "=compareTo"
           },
           link: function(scope, element, attributes, ngModel) {
               ngModel.$validators.compareTo = function(modelValue) {
                   return modelValue == scope.otherModelValue;
               };
               scope.$watch("password", function() {
                   ngModel.$validate();
               });
           }
       };
});

/*
 Events controller
  */
app.controller('eventsCtrl', function($scope) {
        this.tiles = buildGridModel({
            title: "Event Title",
            background: ""
        });
        function buildGridModel(tileTmpl){
            var it, results = [ ];
                it = angular.extend({},tileTmpl);
                it.title = it.title;
                it.span  = { row : 1, col : 1 };
                it.background = "gray";
                it.span.row = it.span.col = 1;

                results.push(it);

            return results;
        }
    });


app.controller('modalCtrl', function($scope, $mdDialog) {
    $scope.alert = '';
    $scope.showAlert = function (ev) {
        $mdDialog.show(
            $mdDialog.alert()
                .parent(angular.element(document.body))
                .title('You are about to Archive this Event!')
                .content('Click to confirm. You can access this Event at any time in Archived Events.')
                .ariaLabel('Alert Dialog Demo')
                .ok('Got it!')
                .targetEvent(ev)
        );
    };
    $scope.showConfirm = function (ev) {
        // Appending dialog to document.body to cover sidenav in docs app
        var confirm = $mdDialog.confirm()
            .title('Would you like to delete this Event?')
            .content('This will permanently delete this Event.')
            .ariaLabel('Confirm Dialog Demo')
            .targetEvent(ev)
            .ok('Yes, delete this Event!')
            .cancel('No way, that was close!');

        $mdDialog.show(confirm).then(function () {
            $scope.status = 'You deleted this event.';
        }, function () {
            $scope.status = 'You did not delete this event.';
        });
    };
    $scope.showAdvanced = function(ev) {
        $mdDialog.show({
            controller: DialogController,
            templateUrl: 'dialog1.tmpl.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose:true
        })
            .then(function(answer) {
                $scope.status = 'You said the information was "' + answer + '".';
            }, function() {
                $scope.status = 'You cancelled the dialog.';
            });
    };
});
function DialogController($scope, $mdDialog) {
    $scope.hide = function() {
        $mdDialog.hide();
    };
    $scope.cancel = function() {
        $mdDialog.cancel();
    };
    $scope.answer = function(answer) {
        $mdDialog.hide(answer);
    };
}

/*
Home controller
 */

/*
 Interviewers controller
  */


/*
 Students controller
  */


/*
Interviewer dialog controller
 */
app.controller('interviewer', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openInterviewer = function(ev){
        $mdDialog.show({
            controller: addInterviewer,
            templateUrl: 'views/partials/dialogs/interviewer/interviewer.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addInterviewer($scope){
        $scope.close = function() {
            $mdDialog.hide();
            $scope.cohorts = [
                {name: 'Delta'},
                {name: 'gamma'},
                {name: 'Epsilon'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        };
        $scope.submit = function(fname, lname, title, company, link, desc){
            var interviewer = {
                fName: fname,
                lName: lname,
                title: title,
                company: company,
                link: link,
                description: desc
            };
            console.log(interviewer);
        };
    }
}]);

/*
Register dialog controller
 */
app.controller('registerOpen', ['$scope', '$mdDialog', '$http', function($scope, $mdDialog){
    $scope.openRegister = function(ev){
        $mdDialog.show({
            controller: register,
            templateUrl: 'views/partials/dialogs/register/register.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function register($scope, $http, $mdDialog) {
        $scope.register = function(username, email, password){
            $http.post('/api/users', {
                username: username,
                email: email,
                password: password
            }).then(function(response){
                console.log(response);
                if(response == 200) {
                    $mdDialog.hide()
                }
            });
        };
        $scope.close = function(){
            $mdDialog.hide();
        };
    }
}]);

/*
Student dialog controller
 */
app.controller('student', ['$scope', '$mdDialog', function($scope,$mdDialog){
    $scope.openStudents = function(ev){
        $mdDialog.show({
            controller: addStudent,
            templateUrl: 'views/partials/dialogs/student/student.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addStudent($scope) {
        $scope.close = function () {
            $mdDialog.hide();
            $scope.companies = [
                {name: 'Prime'},
                {name: 'Nerdery'},
                {name: 'Digital People'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        };
        $scope.submit = function(fname, lname, email, cohort){
            var student = {
                fname: fname,
                lname: lname,
                email: email,
                cohort: cohort
            };
            console.log(student);
        }
    }

}]);

/*
Student dialog controller
 */
app.controller('uploads', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openUploads = function(ev){
        $mdDialog.show({
            controller: uploadFile,
            templateUrl: 'views/partials/dialogs/upload/upload.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function uploadFile($scope, $mdDialog){

        $scope.submit = function(file){
            var mine = {
                file: file
            };
        console.log(mine);
        };
        $scope.close = function() {
            $mdDialog.hide();
        }
    }
}]);

/*
 Forgot controller
  */
app.controller('sendEmail', ['$scope', '$http', '$location', function($scope, $http, $location){
    $scope.send = function(email) {
        $http.post('/forgot', {email: email}).then(function (response) {
            if (response.status == 200) {
                $location.path('/')
            }
        })
    }
}]);

/*
 Login controller
  */
app.controller('login', ['$rootScope','$scope', '$http', '$location', '$mdToast', function($rootScope, $scope, $http, $location, $mdToast){
    $scope.submit = function(username, password){
        $http.post('/authenticate', {username: username, password: password}).then(function(response){
                if(response.data.token){
                    sessionStorage.username = angular.toJson(response.data.user.username);
                    sessionStorage.email = angular.toJson(response.data.user.email);
                    sessionStorage.token = angular.toJson(response.data.token);
                    $location.path('/events');
                    $rootScope.$broadcast('logged In')
                }else{
                    $mdToast.showSimple(response.data.error)
                }

            }

        )
    };
    $scope.forgot = function(){
        $location.path('/forgot');
    }
}]);

/*
 Logout controller
  */
app.controller('logout', ['$rootScope', '$scope','$location', '$interval', function($rootScope, $scope, $location, $interval){
    $scope.logout = function(){
        $location.path('/logout');
        sessionStorage.clear();
        $rootScope.$broadcast('logged In');
        $interval(function() {
            $location.path('/')
        }, 3000, 1)
    };
}]);

/*
 Profile controller
  */
app.controller('profile', ['$scope', '$http', '$window', '$location', function($scope, $http, $window, $location){
    $scope.username = $window.sessionStorage.username.replace(/^"(.*)"$/, '$1');
    $scope.email = $window.sessionStorage.email.replace(/^"(.*)"$/, '$1');
    $scope.save = function(password){
        var username = $scope.username;
        var email = $scope.email;
        $http.post('/change', {username: username, email: email, password: password}).then(function(response){
            if(response.status === 200){
                $location.path('/events')
            }
        });
    }
}]);

/*
 Reset controller
  */
app.controller('reset',['$scope', '$http', '$routeParams', '$location', function($scope, $http, $routeParams, $location){
    $scope.changePass = function(password, confirm){
        console.log(password);
        var token = $routeParams.token;
        if(password === confirm){
            $http.post('/reset', {password: password, token: token}).then(function(response){
                console.log(response);
                if(response.status === 200){
                    $location.path('/');
                }
            })
        }
    }
}]);

/*
Archived events controller
 */

/*
Generate event controller
 */
app.controller('generateCtrl', ['$scope', '$http', function($scope, $http) {

    // time experiments
    var startTime = moment('1:00 PM', 'h:mm A').format('HH:mm');
    var endTime = moment('4:00 PM', 'h:mm A').format('HH:mm');
    var eventLength = moment(endTime, 'HH:mm').diff(moment(startTime, 'HH:mm'), 'minutes');
    var slotLength = moment.duration((eventLength / 9), 'minutes').asMinutes();
    console.log(moment(startTime, 'HH:mm').add((slotLength * 8), 'minutes').format('h:mm A'));

    // Initialize UI Grid variables
    var gridCols = [];
    var gridData = [];

    // UI Grid options
    $scope.gridOptions = {
        enableSorting: false,
        enableGridMenu: true,
        enableFiltering: false,
        onRegisterApi: function (gridApi) {
            $scope.gridApi = gridApi;
        }
    };

    // "Generate" button click function
    $scope.generate = function () {

        // request matches from server given event settings
        $http({
            method: 'GET',
            url: 'http://localhost:3000/test'
        }).then(function successCallback(response) {

            // empty the UI Grid variables in case there is data
            $scope.gridOptions.columnDefs = [];
            $scope.gridOptions.data = [];
            gridCols = [];
            gridData = [];

            // console log API response for debugging
            console.log(response);

            // iterate over the interviewer array within the response
            // create various arrays and objects to meet UI Grid data requirements
            response.data.interviewer.forEach(function(item, pos) {

                // push the company and interviewer name into the column names array
                // this will be the column header for a particular interviewer
                gridCols.push({name: item.company + ' / ' + item.fName, field: item.company + '_' + item.name, width:150, displayName: item.company + ' / ' + item.fName});

                // set the scheduled object to a variable
                // this object contains the entire schedule for an interviewer
                var sched = item.scheduled;

                // initiate an empty students array
                // this will be used to store the formatted schedule for each company
                var students = [];

                // iterate over the scheduled object using the getOwnPropertyNames method
                Object.getOwnPropertyNames(sched).forEach(function (elem, index, array) {
                    // create an array of objects that contains each scheduled item
                    // this array will contain the formatted schedule for an interviewer
                    titleObj = {};
                    titleObj[item.company + '_' + item.fname] = sched[elem];
                    students.push(titleObj);
            });

            // push the updated schedule array into the master gridData array
            gridData.push(students);
            });

            // gridData is still not correctly formatted
            // each item represents an interviewer column
            // when in fact, UI Grid requires each item in the array to be a row of data
            // Underscore unzip function performs necessary matrix transformation
            gridData = _.unzip(gridData);

            // initiate empty array to store each row as an object of objects
            var gridArr = [];

            // iterate over unzipped gridData
            gridData.forEach(function (item, pos) {

                // initiate empty object for storing individual schedule items
                var rowObj = {};

                // iterate over the schedule row
                // each item in the row array represents a single cell in the grid
                item.forEach(function (elem, index) {
                    // use Underscore extend method to "push" each item into row object
                    _.extend(rowObj, elem);
                });

                // push the row object into the previously initiated grid array
                gridArr.push(rowObj);
            });

            // initiate an empty object for storing the entire schedule
            gridObj = {};

            // create time slots column
            var timeSlots = [];
            var slotsSize = gridArr.length;
            while(slotsSize--) {
                timeSlots.push({time: 'Slot ' + ((gridArr.length) - slotsSize)});
            }

            console.log(timeSlots);

            // using Underscore extend again, "push" the array of objects into the master object
            _.extend(gridObj, gridArr);

            // update the gridData variable
            gridData = gridArr;
        }).then(function() {

            // after capturing and formatting the data, update UI Grid options
            $scope.gridOptions.columnDefs = gridCols;
            $scope.gridOptions.data = gridData;
        })
    };
}]);

/*
 New event controller
  */
app.controller('newEventCtrl', ['$scope', '$http', '$location', function($scope, $http, $location) {
    $scope.submit = function() {

        var event = {
            type: $scope.eventType,
            cohort: $scope.cohort,
            date: $scope.date,
            location: $scope.location,
            startTime: $scope.sTime,
            endTime: $scope.eTime,
            interviewDuration: $scope.slotDur,
            organizer: $scope.organizer
        };

        $http({
            method: 'POST',
            url: 'api/event',
            data: event
        }).then(function success(data) {
            console.log(data);
        }, function error() {}).then(function redirect() {
            $location.path('/events')
        })
    }
}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImV2ZW50cy9ldmVudHMuY29udHJvbGxlci5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaW50ZXJ2aWV3ZXJzL2ludGVydmlld2Vycy5jb250cm9sbGVyLmpzIiwic3R1ZGVudHMvc3R1ZGVudHMuY29udHJvbGxlci5qcyIsImRpYWxvZ3MvaW50ZXJ2aWV3ZXIvaW50ZXJ2aWV3ZXIuY29udHJvbGxlci5qcyIsImRpYWxvZ3MvcmVnaXN0ZXIvcmVnaXN0ZXIuY29udHJvbGxlci5qcyIsImRpYWxvZ3Mvc3R1ZGVudC9zdHVkZW50LmNvbnRyb2xsZXIuanMiLCJkaWFsb2dzL3VwbG9hZC91cGxvYWQuY29udHJvbGxlci5qcyIsImFjY291bnQvZm9yZ290L2ZvcmdvdC5jb250cm9sbGVyLmpzIiwiYWNjb3VudC9sb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwiYWNjb3VudC9sb2dvdXQvbG9nb3V0LmNvbnRyb2xsZXIuanMiLCJhY2NvdW50L3Byb2ZpbGUvcHJvZmlsZS5jb250cm9sbGVyLmpzIiwiYWNjb3VudC9yZXNldC9yZXNldC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2FyY2hpdmVkLWV2ZW50cy9hcmNoaXZlZC1ldmVudHMuY29udHJvbGxlci5qcyIsImV2ZW50cy9nZW5lcmF0ZS1zY2hlZHVsZS9nZW5lcmF0ZS1zY2hlZHVsZS5jb250cm9sbGVyLmpzIiwiZXZlbnRzL25ldy1ldmVudC9uZXctZXZlbnQuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlFQTtBQUNBO0FBQ0E7QUFDQTtBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICduZ01lc3NhZ2VzJywgJ3VpLmdyaWQnLCAndWkuZ3JpZC5lZGl0JywgJ3VpLmdyaWQucm93RWRpdCcsICd1aS5ncmlkLmV4cG9ydGVyJ10pO1xuXG5cbi8vIEFuZ3VsYXIgcm91dGluZ1xuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRtZFRoZW1pbmdQcm92aWRlcicsIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJG1kVGhlbWluZ1Byb3ZpZGVyKXtcblxuXG4gICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgLnByaW1hcnlQYWxldHRlKCdibHVlLWdyZXknKVxuICAgICAgICAuYWNjZW50UGFsZXR0ZSgnb3JhbmdlJyk7XG5cblxuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh7XG4gICAgICAgIGVuYWJsZWQ6IHRydWVcbiAgICB9KTtcbiAgICAkcm91dGVQcm92aWRlci5cbiAgICAgICAgd2hlbignL2hvbWUnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2hvbWUvaG9tZS5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignLycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvYWNjb3VudC9sb2dpbi9sb2dpbi5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2ZvcmdvdCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvYWNjb3VudC9mb3Jnb3QvZm9yZ290Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvZXZlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9ldmVudHMvZXZlbnRzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvc3R1ZGVudHMnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL3N0dWRlbnRzL3N0dWRlbnRzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvaW50ZXJ2aWV3ZXJzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9pbnRlcnZpZXdlcnMvaW50ZXJ2aWV3ZXJzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvYXJjaGl2ZWQtZXZlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9ldmVudHMvYXJjaGl2ZWQtZXZlbnRzL2FyY2hpdmVkLWV2ZW50cy5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL3Byb2ZpbGUnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2FjY291bnQvcHJvZmlsZS9wcm9maWxlLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvbG9nb3V0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9hY2NvdW50L2xvZ291dC9sb2dvdXQuaHRtbCdcbiAgICAgICAgfSkuXG4gICAgICAgIHdoZW4oJy9uZXctZXZlbnQnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2V2ZW50cy9uZXctZXZlbnQvbmV3LWV2ZW50Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvcmVzZXQvOnRva2VuJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9hY2NvdW50L3Jlc2V0L3Jlc2V0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3Jlc2V0J1xuICAgICAgICB9KS5cbiAgICAgICAgb3RoZXJ3aXNlKHtcbiAgICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgIH0pXG59XSk7XG5cbi8qXG5Ub29sYmFyIGNvbnRyb2xsZXJcbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ3Rvb2xiYXInLCBbJyRyb290U2NvcGUnLCckbG9jYXRpb24nLCckc2NvcGUnLCAnJHdpbmRvdycsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJHNjb3BlLCAkd2luZG93KXtcbiAgICAkc2NvcGUucGF0aHMgPSB0cnVlO1xuICAgICRyb290U2NvcGUuJG9uKCdsb2dnZWQgSW4nLCBmdW5jdGlvbigpe1xuICAgICAgICBpZigkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuID09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAkc2NvcGUucGF0aHMgPSB0cnVlO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICRzY29wZS5wYXRocyA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudXNlcm5hbWUucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgJHNjb3BlLmdvSG9tZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgfVxufV0pO1xuXG4vKlxuRGlyZWN0aXZlIHRvIGNoZWNrIHRoZSBwYXNzd29yZHMgYXJlIHRoZSBzYW1lXG4gKi9cbmFwcC5kaXJlY3RpdmUoJ3ZlcmlmeVNhbWUnLCBmdW5jdGlvbigpe1xuICAgICAgIHJldHVybiB7XG4gICAgICAgICAgIHJlcXVpcmU6IFwibmdNb2RlbFwiLFxuICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgb3RoZXJNb2RlbFZhbHVlOiBcIj1jb21wYXJlVG9cIlxuICAgICAgICAgICB9LFxuICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgbmdNb2RlbCkge1xuICAgICAgICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5jb21wYXJlVG8gPSBmdW5jdGlvbihtb2RlbFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsVmFsdWUgPT0gc2NvcGUub3RoZXJNb2RlbFZhbHVlO1xuICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcInBhc3N3b3JkXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgfVxuICAgICAgIH07XG59KTsiLCJcbi8qXG4gRXZlbnRzIGNvbnRyb2xsZXJcbiAgKi9cbmFwcC5jb250cm9sbGVyKCdldmVudHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7XG4gICAgICAgIHRoaXMudGlsZXMgPSBidWlsZEdyaWRNb2RlbCh7XG4gICAgICAgICAgICB0aXRsZTogXCJFdmVudCBUaXRsZVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZDogXCJcIlxuICAgICAgICB9KTtcbiAgICAgICAgZnVuY3Rpb24gYnVpbGRHcmlkTW9kZWwodGlsZVRtcGwpe1xuICAgICAgICAgICAgdmFyIGl0LCByZXN1bHRzID0gWyBdO1xuICAgICAgICAgICAgICAgIGl0ID0gYW5ndWxhci5leHRlbmQoe30sdGlsZVRtcGwpO1xuICAgICAgICAgICAgICAgIGl0LnRpdGxlID0gaXQudGl0bGU7XG4gICAgICAgICAgICAgICAgaXQuc3BhbiAgPSB7IHJvdyA6IDEsIGNvbCA6IDEgfTtcbiAgICAgICAgICAgICAgICBpdC5iYWNrZ3JvdW5kID0gXCJncmF5XCI7XG4gICAgICAgICAgICAgICAgaXQuc3Bhbi5yb3cgPSBpdC5zcGFuLmNvbCA9IDE7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goaXQpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbmFwcC5jb250cm9sbGVyKCdtb2RhbEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRtZERpYWxvZykge1xuICAgICRzY29wZS5hbGVydCA9ICcnO1xuICAgICRzY29wZS5zaG93QWxlcnQgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgJG1kRGlhbG9nLnNob3coXG4gICAgICAgICAgICAkbWREaWFsb2cuYWxlcnQoKVxuICAgICAgICAgICAgICAgIC5wYXJlbnQoYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpKVxuICAgICAgICAgICAgICAgIC50aXRsZSgnWW91IGFyZSBhYm91dCB0byBBcmNoaXZlIHRoaXMgRXZlbnQhJylcbiAgICAgICAgICAgICAgICAuY29udGVudCgnQ2xpY2sgdG8gY29uZmlybS4gWW91IGNhbiBhY2Nlc3MgdGhpcyBFdmVudCBhdCBhbnkgdGltZSBpbiBBcmNoaXZlZCBFdmVudHMuJylcbiAgICAgICAgICAgICAgICAuYXJpYUxhYmVsKCdBbGVydCBEaWFsb2cgRGVtbycpXG4gICAgICAgICAgICAgICAgLm9rKCdHb3QgaXQhJylcbiAgICAgICAgICAgICAgICAudGFyZ2V0RXZlbnQoZXYpXG4gICAgICAgICk7XG4gICAgfTtcbiAgICAkc2NvcGUuc2hvd0NvbmZpcm0gPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgLy8gQXBwZW5kaW5nIGRpYWxvZyB0byBkb2N1bWVudC5ib2R5IHRvIGNvdmVyIHNpZGVuYXYgaW4gZG9jcyBhcHBcbiAgICAgICAgdmFyIGNvbmZpcm0gPSAkbWREaWFsb2cuY29uZmlybSgpXG4gICAgICAgICAgICAudGl0bGUoJ1dvdWxkIHlvdSBsaWtlIHRvIGRlbGV0ZSB0aGlzIEV2ZW50PycpXG4gICAgICAgICAgICAuY29udGVudCgnVGhpcyB3aWxsIHBlcm1hbmVudGx5IGRlbGV0ZSB0aGlzIEV2ZW50LicpXG4gICAgICAgICAgICAuYXJpYUxhYmVsKCdDb25maXJtIERpYWxvZyBEZW1vJylcbiAgICAgICAgICAgIC50YXJnZXRFdmVudChldilcbiAgICAgICAgICAgIC5vaygnWWVzLCBkZWxldGUgdGhpcyBFdmVudCEnKVxuICAgICAgICAgICAgLmNhbmNlbCgnTm8gd2F5LCB0aGF0IHdhcyBjbG9zZSEnKTtcblxuICAgICAgICAkbWREaWFsb2cuc2hvdyhjb25maXJtKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5zdGF0dXMgPSAnWW91IGRlbGV0ZWQgdGhpcyBldmVudC4nO1xuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1lvdSBkaWQgbm90IGRlbGV0ZSB0aGlzIGV2ZW50Lic7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgJHNjb3BlLnNob3dBZHZhbmNlZCA9IGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IERpYWxvZ0NvbnRyb2xsZXIsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2RpYWxvZzEudG1wbC5odG1sJyxcbiAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxuICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTp0cnVlXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihhbnN3ZXIpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1lvdSBzYWlkIHRoZSBpbmZvcm1hdGlvbiB3YXMgXCInICsgYW5zd2VyICsgJ1wiLic7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1lvdSBjYW5jZWxsZWQgdGhlIGRpYWxvZy4nO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcbn0pO1xuZnVuY3Rpb24gRGlhbG9nQ29udHJvbGxlcigkc2NvcGUsICRtZERpYWxvZykge1xuICAgICRzY29wZS5oaWRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgfTtcbiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRtZERpYWxvZy5jYW5jZWwoKTtcbiAgICB9O1xuICAgICRzY29wZS5hbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpIHtcbiAgICAgICAgJG1kRGlhbG9nLmhpZGUoYW5zd2VyKTtcbiAgICB9O1xufSIsIlxuLypcbkhvbWUgY29udHJvbGxlclxuICovIiwiXG4vKlxuIEludGVydmlld2VycyBjb250cm9sbGVyXG4gICovXG4iLCJcbi8qXG4gU3R1ZGVudHMgY29udHJvbGxlclxuICAqL1xuIiwiXG4vKlxuSW50ZXJ2aWV3ZXIgZGlhbG9nIGNvbnRyb2xsZXJcbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ2ludGVydmlld2VyJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuSW50ZXJ2aWV3ZXIgPSBmdW5jdGlvbihldil7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGFkZEludGVydmlld2VyLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL2ludGVydmlld2VyL2ludGVydmlld2VyLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiBhZGRJbnRlcnZpZXdlcigkc2NvcGUpe1xuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuY29ob3J0cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ0RlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdnYW1tYSd9LFxuICAgICAgICAgICAgICAgIHtuYW1lOiAnRXBzaWxvbid9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgJHNjb3BlLmV2ZW50cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIERlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdjYXJlZXIgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIEVwc2lsb24nfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKGZuYW1lLCBsbmFtZSwgdGl0bGUsIGNvbXBhbnksIGxpbmssIGRlc2Mpe1xuICAgICAgICAgICAgdmFyIGludGVydmlld2VyID0ge1xuICAgICAgICAgICAgICAgIGZOYW1lOiBmbmFtZSxcbiAgICAgICAgICAgICAgICBsTmFtZTogbG5hbWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgICAgIGNvbXBhbnk6IGNvbXBhbnksXG4gICAgICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGludGVydmlld2VyKTtcbiAgICAgICAgfTtcbiAgICB9XG59XSk7IiwiXG4vKlxuUmVnaXN0ZXIgZGlhbG9nIGNvbnRyb2xsZXJcbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyT3BlbicsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJG1kRGlhbG9nKXtcbiAgICAkc2NvcGUub3BlblJlZ2lzdGVyID0gZnVuY3Rpb24oZXYpe1xuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICBjb250cm9sbGVyOiByZWdpc3RlcixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy9yZWdpc3Rlci9yZWdpc3Rlci5odG1sJyxcbiAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxuICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZVxuICAgICAgICB9KVxuICAgIH07XG4gICAgZnVuY3Rpb24gcmVnaXN0ZXIoJHNjb3BlLCAkaHR0cCwgJG1kRGlhbG9nKSB7XG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQpe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9O1xuICAgIH1cbn1dKTsiLCJcbi8qXG5TdHVkZW50IGRpYWxvZyBjb250cm9sbGVyXG4gKi9cbmFwcC5jb250cm9sbGVyKCdzdHVkZW50JywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCRtZERpYWxvZyl7XG4gICAgJHNjb3BlLm9wZW5TdHVkZW50cyA9IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgY29udHJvbGxlcjogYWRkU3R1ZGVudCxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy9zdHVkZW50L3N0dWRlbnQuaHRtbCcsXG4gICAgICAgICAgICBwYXJlbnQ6IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5ib2R5KSxcbiAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldixcbiAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWVcbiAgICAgICAgfSlcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGFkZFN0dWRlbnQoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuY29tcGFuaWVzID0gW1xuICAgICAgICAgICAgICAgIHtuYW1lOiAnUHJpbWUnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ05lcmRlcnknfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ0RpZ2l0YWwgUGVvcGxlJ31cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICAkc2NvcGUuZXZlbnRzID0gW1xuICAgICAgICAgICAgICAgIHtuYW1lOiAnbW9ja3MgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ2NhcmVlciBEZWx0YSd9LFxuICAgICAgICAgICAgICAgIHtuYW1lOiAnbW9ja3MgRXBzaWxvbid9XG4gICAgICAgICAgICBdO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oZm5hbWUsIGxuYW1lLCBlbWFpbCwgY29ob3J0KXtcbiAgICAgICAgICAgIHZhciBzdHVkZW50ID0ge1xuICAgICAgICAgICAgICAgIGZuYW1lOiBmbmFtZSxcbiAgICAgICAgICAgICAgICBsbmFtZTogbG5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIGNvaG9ydDogY29ob3J0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3R1ZGVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn1dKTsiLCJcbi8qXG5TdHVkZW50IGRpYWxvZyBjb250cm9sbGVyXG4gKi9cbmFwcC5jb250cm9sbGVyKCd1cGxvYWRzJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuVXBsb2FkcyA9IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgY29udHJvbGxlcjogdXBsb2FkRmlsZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy91cGxvYWQvdXBsb2FkLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiB1cGxvYWRGaWxlKCRzY29wZSwgJG1kRGlhbG9nKXtcblxuICAgICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oZmlsZSl7XG4gICAgICAgICAgICB2YXIgbWluZSA9IHtcbiAgICAgICAgICAgICAgICBmaWxlOiBmaWxlXG4gICAgICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZyhtaW5lKTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxufV0pOyIsIlxuLypcbiBGb3Jnb3QgY29udHJvbGxlclxuICAqL1xuYXBwLmNvbnRyb2xsZXIoJ3NlbmRFbWFpbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnNlbmQgPSBmdW5jdGlvbihlbWFpbCkge1xuICAgICAgICAkaHR0cC5wb3N0KCcvZm9yZ290Jywge2VtYWlsOiBlbWFpbH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG59XSk7IiwiXG4vKlxuIExvZ2luIGNvbnRyb2xsZXJcbiAgKi9cbmFwcC5jb250cm9sbGVyKCdsb2dpbicsIFsnJHJvb3RTY29wZScsJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnJG1kVG9hc3QnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sICRtZFRvYXN0KXtcbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcbiAgICAgICAgJGh0dHAucG9zdCgnL2F1dGhlbnRpY2F0ZScsIHt1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEudG9rZW4pe1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS51c2VybmFtZSA9IGFuZ3VsYXIudG9Kc29uKHJlc3BvbnNlLmRhdGEudXNlci51c2VybmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLmVtYWlsID0gYW5ndWxhci50b0pzb24ocmVzcG9uc2UuZGF0YS51c2VyLmVtYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UudG9rZW4gPSBhbmd1bGFyLnRvSnNvbihyZXNwb25zZS5kYXRhLnRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudHMnKTtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2dnZWQgSW4nKVxuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAkbWRUb2FzdC5zaG93U2ltcGxlKHJlc3BvbnNlLmRhdGEuZXJyb3IpXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgKVxuICAgIH07XG4gICAgJHNjb3BlLmZvcmdvdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZm9yZ290Jyk7XG4gICAgfVxufV0pOyIsIlxuLypcbiBMb2dvdXQgY29udHJvbGxlclxuICAqL1xuYXBwLmNvbnRyb2xsZXIoJ2xvZ291dCcsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCckbG9jYXRpb24nLCAnJGludGVydmFsJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkbG9jYXRpb24sICRpbnRlcnZhbCl7XG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9nb3V0Jyk7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKCk7XG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2VkIEluJyk7XG4gICAgICAgICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJylcbiAgICAgICAgfSwgMzAwMCwgMSlcbiAgICB9O1xufV0pOyIsIlxuLypcbiBQcm9maWxlIGNvbnRyb2xsZXJcbiAgKi9cbmFwcC5jb250cm9sbGVyKCdwcm9maWxlJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJHdpbmRvdycsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkd2luZG93LCAkbG9jYXRpb24pe1xuICAgICRzY29wZS51c2VybmFtZSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudXNlcm5hbWUucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpO1xuICAgICRzY29wZS5lbWFpbCA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZW1haWwucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpO1xuICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24ocGFzc3dvcmQpe1xuICAgICAgICB2YXIgdXNlcm5hbWUgPSAkc2NvcGUudXNlcm5hbWU7XG4gICAgICAgIHZhciBlbWFpbCA9ICRzY29wZS5lbWFpbDtcbiAgICAgICAgJGh0dHAucG9zdCgnL2NoYW5nZScsIHt1c2VybmFtZTogdXNlcm5hbWUsIGVtYWlsOiBlbWFpbCwgcGFzc3dvcmQ6IHBhc3N3b3JkfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICBpZihyZXNwb25zZS5zdGF0dXMgPT09IDIwMCl7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudHMnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XSk7IiwiXG4vKlxuIFJlc2V0IGNvbnRyb2xsZXJcbiAgKi9cbmFwcC5jb250cm9sbGVyKCdyZXNldCcsWyckc2NvcGUnLCAnJGh0dHAnLCAnJHJvdXRlUGFyYW1zJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUuY2hhbmdlUGFzcyA9IGZ1bmN0aW9uKHBhc3N3b3JkLCBjb25maXJtKXtcbiAgICAgICAgY29uc29sZS5sb2cocGFzc3dvcmQpO1xuICAgICAgICB2YXIgdG9rZW4gPSAkcm91dGVQYXJhbXMudG9rZW47XG4gICAgICAgIGlmKHBhc3N3b3JkID09PSBjb25maXJtKXtcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9yZXNldCcsIHtwYXNzd29yZDogcGFzc3dvcmQsIHRva2VuOiB0b2tlbn0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5zdGF0dXMgPT09IDIwMCl7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbn1dKTsiLCJcbi8qXG5BcmNoaXZlZCBldmVudHMgY29udHJvbGxlclxuICovIiwiXG4vKlxuR2VuZXJhdGUgZXZlbnQgY29udHJvbGxlclxuICovXG5hcHAuY29udHJvbGxlcignZ2VuZXJhdGVDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG5cbiAgICAvLyB0aW1lIGV4cGVyaW1lbnRzXG4gICAgdmFyIHN0YXJ0VGltZSA9IG1vbWVudCgnMTowMCBQTScsICdoOm1tIEEnKS5mb3JtYXQoJ0hIOm1tJyk7XG4gICAgdmFyIGVuZFRpbWUgPSBtb21lbnQoJzQ6MDAgUE0nLCAnaDptbSBBJykuZm9ybWF0KCdISDptbScpO1xuICAgIHZhciBldmVudExlbmd0aCA9IG1vbWVudChlbmRUaW1lLCAnSEg6bW0nKS5kaWZmKG1vbWVudChzdGFydFRpbWUsICdISDptbScpLCAnbWludXRlcycpO1xuICAgIHZhciBzbG90TGVuZ3RoID0gbW9tZW50LmR1cmF0aW9uKChldmVudExlbmd0aCAvIDkpLCAnbWludXRlcycpLmFzTWludXRlcygpO1xuICAgIGNvbnNvbGUubG9nKG1vbWVudChzdGFydFRpbWUsICdISDptbScpLmFkZCgoc2xvdExlbmd0aCAqIDgpLCAnbWludXRlcycpLmZvcm1hdCgnaDptbSBBJykpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBVSSBHcmlkIHZhcmlhYmxlc1xuICAgIHZhciBncmlkQ29scyA9IFtdO1xuICAgIHZhciBncmlkRGF0YSA9IFtdO1xuXG4gICAgLy8gVUkgR3JpZCBvcHRpb25zXG4gICAgJHNjb3BlLmdyaWRPcHRpb25zID0ge1xuICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgZW5hYmxlR3JpZE1lbnU6IHRydWUsXG4gICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgIG9uUmVnaXN0ZXJBcGk6IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gXCJHZW5lcmF0ZVwiIGJ1dHRvbiBjbGljayBmdW5jdGlvblxuICAgICRzY29wZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvLyByZXF1ZXN0IG1hdGNoZXMgZnJvbSBzZXJ2ZXIgZ2l2ZW4gZXZlbnQgc2V0dGluZ3NcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC90ZXN0J1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAvLyBlbXB0eSB0aGUgVUkgR3JpZCB2YXJpYWJsZXMgaW4gY2FzZSB0aGVyZSBpcyBkYXRhXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IFtdO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIGdyaWRDb2xzID0gW107XG4gICAgICAgICAgICBncmlkRGF0YSA9IFtdO1xuXG4gICAgICAgICAgICAvLyBjb25zb2xlIGxvZyBBUEkgcmVzcG9uc2UgZm9yIGRlYnVnZ2luZ1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIGludGVydmlld2VyIGFycmF5IHdpdGhpbiB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgIC8vIGNyZWF0ZSB2YXJpb3VzIGFycmF5cyBhbmQgb2JqZWN0cyB0byBtZWV0IFVJIEdyaWQgZGF0YSByZXF1aXJlbWVudHNcbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuaW50ZXJ2aWV3ZXIuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBwb3MpIHtcblxuICAgICAgICAgICAgICAgIC8vIHB1c2ggdGhlIGNvbXBhbnkgYW5kIGludGVydmlld2VyIG5hbWUgaW50byB0aGUgY29sdW1uIG5hbWVzIGFycmF5XG4gICAgICAgICAgICAgICAgLy8gdGhpcyB3aWxsIGJlIHRoZSBjb2x1bW4gaGVhZGVyIGZvciBhIHBhcnRpY3VsYXIgaW50ZXJ2aWV3ZXJcbiAgICAgICAgICAgICAgICBncmlkQ29scy5wdXNoKHtuYW1lOiBpdGVtLmNvbXBhbnkgKyAnIC8gJyArIGl0ZW0uZk5hbWUsIGZpZWxkOiBpdGVtLmNvbXBhbnkgKyAnXycgKyBpdGVtLm5hbWUsIHdpZHRoOjE1MCwgZGlzcGxheU5hbWU6IGl0ZW0uY29tcGFueSArICcgLyAnICsgaXRlbS5mTmFtZX0pO1xuXG4gICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBzY2hlZHVsZWQgb2JqZWN0IHRvIGEgdmFyaWFibGVcbiAgICAgICAgICAgICAgICAvLyB0aGlzIG9iamVjdCBjb250YWlucyB0aGUgZW50aXJlIHNjaGVkdWxlIGZvciBhbiBpbnRlcnZpZXdlclxuICAgICAgICAgICAgICAgIHZhciBzY2hlZCA9IGl0ZW0uc2NoZWR1bGVkO1xuXG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhdGUgYW4gZW1wdHkgc3R1ZGVudHMgYXJyYXlcbiAgICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgYmUgdXNlZCB0byBzdG9yZSB0aGUgZm9ybWF0dGVkIHNjaGVkdWxlIGZvciBlYWNoIGNvbXBhbnlcbiAgICAgICAgICAgICAgICB2YXIgc3R1ZGVudHMgPSBbXTtcblxuICAgICAgICAgICAgICAgIC8vIGl0ZXJhdGUgb3ZlciB0aGUgc2NoZWR1bGVkIG9iamVjdCB1c2luZyB0aGUgZ2V0T3duUHJvcGVydHlOYW1lcyBtZXRob2RcbiAgICAgICAgICAgICAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhzY2hlZCkuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSwgaW5kZXgsIGFycmF5KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgY29udGFpbnMgZWFjaCBzY2hlZHVsZWQgaXRlbVxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGFycmF5IHdpbGwgY29udGFpbiB0aGUgZm9ybWF0dGVkIHNjaGVkdWxlIGZvciBhbiBpbnRlcnZpZXdlclxuICAgICAgICAgICAgICAgICAgICB0aXRsZU9iaiA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB0aXRsZU9ialtpdGVtLmNvbXBhbnkgKyAnXycgKyBpdGVtLmZuYW1lXSA9IHNjaGVkW2VsZW1dO1xuICAgICAgICAgICAgICAgICAgICBzdHVkZW50cy5wdXNoKHRpdGxlT2JqKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBwdXNoIHRoZSB1cGRhdGVkIHNjaGVkdWxlIGFycmF5IGludG8gdGhlIG1hc3RlciBncmlkRGF0YSBhcnJheVxuICAgICAgICAgICAgZ3JpZERhdGEucHVzaChzdHVkZW50cyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gZ3JpZERhdGEgaXMgc3RpbGwgbm90IGNvcnJlY3RseSBmb3JtYXR0ZWRcbiAgICAgICAgICAgIC8vIGVhY2ggaXRlbSByZXByZXNlbnRzIGFuIGludGVydmlld2VyIGNvbHVtblxuICAgICAgICAgICAgLy8gd2hlbiBpbiBmYWN0LCBVSSBHcmlkIHJlcXVpcmVzIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkgdG8gYmUgYSByb3cgb2YgZGF0YVxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZSB1bnppcCBmdW5jdGlvbiBwZXJmb3JtcyBuZWNlc3NhcnkgbWF0cml4IHRyYW5zZm9ybWF0aW9uXG4gICAgICAgICAgICBncmlkRGF0YSA9IF8udW56aXAoZ3JpZERhdGEpO1xuXG4gICAgICAgICAgICAvLyBpbml0aWF0ZSBlbXB0eSBhcnJheSB0byBzdG9yZSBlYWNoIHJvdyBhcyBhbiBvYmplY3Qgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgdmFyIGdyaWRBcnIgPSBbXTtcblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHVuemlwcGVkIGdyaWREYXRhXG4gICAgICAgICAgICBncmlkRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBwb3MpIHtcblxuICAgICAgICAgICAgICAgIC8vIGluaXRpYXRlIGVtcHR5IG9iamVjdCBmb3Igc3RvcmluZyBpbmRpdmlkdWFsIHNjaGVkdWxlIGl0ZW1zXG4gICAgICAgICAgICAgICAgdmFyIHJvd09iaiA9IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBzY2hlZHVsZSByb3dcbiAgICAgICAgICAgICAgICAvLyBlYWNoIGl0ZW0gaW4gdGhlIHJvdyBhcnJheSByZXByZXNlbnRzIGEgc2luZ2xlIGNlbGwgaW4gdGhlIGdyaWRcbiAgICAgICAgICAgICAgICBpdGVtLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZSBVbmRlcnNjb3JlIGV4dGVuZCBtZXRob2QgdG8gXCJwdXNoXCIgZWFjaCBpdGVtIGludG8gcm93IG9iamVjdFxuICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZChyb3dPYmosIGVsZW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gcHVzaCB0aGUgcm93IG9iamVjdCBpbnRvIHRoZSBwcmV2aW91c2x5IGluaXRpYXRlZCBncmlkIGFycmF5XG4gICAgICAgICAgICAgICAgZ3JpZEFyci5wdXNoKHJvd09iaik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaW5pdGlhdGUgYW4gZW1wdHkgb2JqZWN0IGZvciBzdG9yaW5nIHRoZSBlbnRpcmUgc2NoZWR1bGVcbiAgICAgICAgICAgIGdyaWRPYmogPSB7fTtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIHRpbWUgc2xvdHMgY29sdW1uXG4gICAgICAgICAgICB2YXIgdGltZVNsb3RzID0gW107XG4gICAgICAgICAgICB2YXIgc2xvdHNTaXplID0gZ3JpZEFyci5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZShzbG90c1NpemUtLSkge1xuICAgICAgICAgICAgICAgIHRpbWVTbG90cy5wdXNoKHt0aW1lOiAnU2xvdCAnICsgKChncmlkQXJyLmxlbmd0aCkgLSBzbG90c1NpemUpfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRpbWVTbG90cyk7XG5cbiAgICAgICAgICAgIC8vIHVzaW5nIFVuZGVyc2NvcmUgZXh0ZW5kIGFnYWluLCBcInB1c2hcIiB0aGUgYXJyYXkgb2Ygb2JqZWN0cyBpbnRvIHRoZSBtYXN0ZXIgb2JqZWN0XG4gICAgICAgICAgICBfLmV4dGVuZChncmlkT2JqLCBncmlkQXJyKTtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBncmlkRGF0YSB2YXJpYWJsZVxuICAgICAgICAgICAgZ3JpZERhdGEgPSBncmlkQXJyO1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBhZnRlciBjYXB0dXJpbmcgYW5kIGZvcm1hdHRpbmcgdGhlIGRhdGEsIHVwZGF0ZSBVSSBHcmlkIG9wdGlvbnNcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZENvbHM7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IGdyaWREYXRhO1xuICAgICAgICB9KVxuICAgIH07XG59XSk7IiwiXG4vKlxuIE5ldyBldmVudCBjb250cm9sbGVyXG4gICovXG5hcHAuY29udHJvbGxlcignbmV3RXZlbnRDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBldmVudCA9IHtcbiAgICAgICAgICAgIHR5cGU6ICRzY29wZS5ldmVudFR5cGUsXG4gICAgICAgICAgICBjb2hvcnQ6ICRzY29wZS5jb2hvcnQsXG4gICAgICAgICAgICBkYXRlOiAkc2NvcGUuZGF0ZSxcbiAgICAgICAgICAgIGxvY2F0aW9uOiAkc2NvcGUubG9jYXRpb24sXG4gICAgICAgICAgICBzdGFydFRpbWU6ICRzY29wZS5zVGltZSxcbiAgICAgICAgICAgIGVuZFRpbWU6ICRzY29wZS5lVGltZSxcbiAgICAgICAgICAgIGludGVydmlld0R1cmF0aW9uOiAkc2NvcGUuc2xvdER1cixcbiAgICAgICAgICAgIG9yZ2FuaXplcjogJHNjb3BlLm9yZ2FuaXplclxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnYXBpL2V2ZW50JyxcbiAgICAgICAgICAgIGRhdGE6IGV2ZW50XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoKSB7fSkudGhlbihmdW5jdGlvbiByZWRpcmVjdCgpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRzJylcbiAgICAgICAgfSlcbiAgICB9XG59XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
