var app = angular.module('app', ['ngMaterial', 'ngRoute', 'ngMessages', 'ui.grid', 'ui.grid.edit', 'ui.grid.rowEdit', 'ui.grid.exporter', 'ngFileUpload']);

/*
 Angular configuration
 */
app.config(['$routeProvider', '$locationProvider', '$mdThemingProvider', function($routeProvider, $locationProvider, $mdThemingProvider){

    // Color palette
    $mdThemingProvider.theme('default')
        .primaryPalette('blue-grey')
        .accentPalette('orange');

    // HTML5 mode
    $locationProvider.html5Mode({
        enabled: true
    });

    // Routes
    $routeProvider.
        when('/home', {
            templateUrl: 'views/partials/home/home.html'
        }).
        when('/', {
            templateUrl: 'views/partials/account/login/login.html'
        }).
        when('/forgot', {
            templateUrl: 'views/partials/account/forgot/forgot.html'
        }).
        when('/events', {
            templateUrl: 'views/partials/events/events-list/events-list.html'
        }).
        when('/event?:eventId', {
            templateUrl: 'views/partials/events/view-event/view-event.html'
        }).
        when('/event/add-students?:eventId', {
            templateUrl: 'views/partials/events/add-students/add-students.html'
        }).
        when('/event/add-interviewers?:eventId', {
            templateUrl: 'views/partials/events/add-interviewers/add-interviewers.html'
        }).
        when('/event/schedule?:eventId', {
            templateUrl: 'views/partials/events/schedule/schedule.html'
        }).
        when('/students', {
            templateUrl: 'views/partials/students/students.html'
        }).
        when('/interviewers', {
            templateUrl: 'views/partials/interviewers/interviewers.html'
        }).
        when('/archived-events', {
            templateUrl: 'views/partials/events/archived-events/archived-events.html'
        }).
        when('/profile', {
            templateUrl: 'views/partials/account/profile/profile.html'
        }).
        when('/logout', {
            templateUrl: 'views/partials/account/logout/logout.html'
        }).
        when('/new-event', {
            templateUrl: 'views/partials/events/new-event/new-event.html'
        }).
        when('/reset/:token', {
            templateUrl: 'views/partials/account/reset/reset.html',
            controller: 'reset'
        }).
        otherwise({
            redirectTo: '/'
    })
}]);

/*
Toolbar controller
 */
app.controller('toolbar', ['$rootScope','$location','$scope', '$window', function($rootScope, $location, $scope, $window){
    $scope.paths = true;
    $rootScope.$on('logged In', function(){
        if($window.sessionStorage.token == undefined){
            $scope.paths = true;
        }else{
            $scope.paths = false;
            $scope.user = {
                username: $window.sessionStorage.username.replace(/^"(.*)"$/, '$1')
            };
        }
    });
    $scope.goHome = function(){
        $location.path('/');
    }
}]);

/*
Directive to check the passwords are the same
 */
app.directive("passwordVerify", function() {
    return {
        require: "ngModel",
        scope: {
            passwordVerify: '='
        },
        link: function(scope, element, attrs, ctrl) {
            scope.$watch(function() {
                var combined;
                if (scope.passwordVerify || ctrl.$viewValue) {
                    combined = scope.passwordVerify + '_' + ctrl.$viewValue;
                }
                return combined;
            }, function(value) {
                if (value) {
                    ctrl.$parsers.unshift(function(viewValue) {
                        var origin = scope.passwordVerify;
                        if (origin !== viewValue) {
                            ctrl.$setValidity("passwordVerify", false);
                            return undefined;
                        } else {
                            ctrl.$setValidity("passwordVerify", true);
                            return viewValue;
                        }
                    });
                }
            });
        }
    };
});
app.controller('interviewers', ['$scope', '$http', function($scope, $http){
  $http.get('/api/interviewer').then(function(response){
   console.log(response);
   $scope.interviewers = response.data
  });
 $scope.editInterviewer = function(id) {
  $http.get('/api/interviewer?_id=' + id).then(function (response) {
   $scope.interviewer = response.data[0];
   $mdDialog.show({
    controller: 'editInterviewer',
    locals: {
     items: $scope.interviewer
    },
    templateUrl: 'views/partials/dialogs/interviewer/interviewerEdit.html',
    parent: angular.element(document.body),
    clickOutsideToClose: true
   })
  })
 }
}]);

app.controller('editInterviewer', ['$scope', '$mdDialog', 'items', function($scope, $mdDialog, items){
 $scope.interviewer = items;
 console.log(items);

 $scope.close = function(){
  $mdDialog.hide();
 }
}]);
app.controller('students', ['$scope', '$http', '$mdDialog', function($scope, $http, $mdDialog){
    $http.get('/api/student').then(function (response) {
        $scope.students = response.data
    });

    $scope.editStudent = function(id) {
        $http.get('/api/student?_id=' + id).then(function (response) {
            $scope.student = response.data[0];
            console.log('hello');
            $mdDialog.show({
                controller: 'editStudent',
                locals: {
                    items: $scope.student
                },
                templateUrl: 'views/partials/dialogs/student/studentEdit.html',
                parent: angular.element(document.body),
                clickOutsideToClose: true
            })
        })
    };
}]);
app.controller('editStudent', ['$scope', '$mdDialog', 'items', function($scope, $mdDialog, items){
    $scope.student = items;

    $scope.close = function(){
        $mdDialog.hide();
    }
}]);

/*
Home controller
 */

/*
Student dialog controller
 */
app.controller('student', ['$scope', '$mdDialog', function($scope,$mdDialog){
    $scope.openStudents = function(ev){
        $mdDialog.show({
            controller: addStudent,
            templateUrl: 'views/partials/dialogs/student/student.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addStudent($scope) {
        $scope.close = function () {
            $mdDialog.hide();
            $scope.companies = [
                {name: 'Prime'},
                {name: 'Nerdery'},
                {name: 'Digital People'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        };
        $scope.submit = function(fname, lname, email, cohort){
            var student = {
                fname: fname,
                lname: lname,
                email: email,
                cohort: cohort
            };
            console.log(student);
        }
    }

}]);

/*
Interviewer dialog controller
 */
app.controller('interviewer', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openInterviewer = function(ev){
        $mdDialog.show({
            controller: addInterviewer,
            templateUrl: 'views/partials/dialogs/interviewer/interviewer.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addInterviewer($scope){
        $scope.close = function() {
            $mdDialog.hide();
            $scope.cohorts = [
                {name: 'Delta'},
                {name: 'gamma'},
                {name: 'Epsilon'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        };
        $scope.submit = function(fname, lname, title, company, link, desc){
            var interviewer = {
                fName: fname,
                lName: lname,
                title: title,
                company: company,
                link: link,
                description: desc
            };
            console.log(interviewer);
        };
    }
}]);

/*
Student dialog controller
 */
app.controller('uploads', ['$scope', '$mdDialog', 'Upload', '$routeParams', '$location', function($scope, $mdDialog, Upload, $location){
    $scope.openUploads = function(ev){
        $mdDialog.show({
            controller: uploadFile,
            templateUrl: 'views/partials/dialogs/upload/upload.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function uploadFile($scope, $mdDialog, Upload, $location){

        var target = $location.path();

        // upload on file select or drop
        $scope.upload = function (file) {
            Upload.upload({
                url: '/api/upload',
                data: {file: file, target: target}
            }).then(function (resp) {
                console.log('Success ' + resp.config.data.file.name + 'uploaded. Response: ' + resp.data);
                $mdDialog.hide();
            }, function (resp) {
                console.log('Error status: ' + resp.status);
            }, function (evt) {
                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
                console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);
            });
        };

        $scope.close = function() {
            $mdDialog.hide();
        }
    }
}]);

/*
Register dialog controller
 */
app.controller('registerOpen', ['$scope', '$mdDialog', '$http', function($scope, $mdDialog){
    $scope.openRegister = function(ev){
        $mdDialog.show({
            controller: register,
            templateUrl: 'views/partials/dialogs/register/register.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function register($scope, $http, $mdDialog) {
        $scope.register = function(username, email, password){
            $http.post('/api/users', {
                username: username,
                email: email,
                password: password
            }).then(function(response){
                console.log(response);
                if(response == 200) {
                    $mdDialog.hide()
                }
            });
        };
        $scope.close = function(){
            $mdDialog.hide();
        };
    }
}]);

/*
 Logout controller
  */
app.controller('logout', ['$rootScope', '$scope','$location', '$interval', function($rootScope, $scope, $location, $interval){
    $scope.logout = function(){
        $location.path('/logout');
        sessionStorage.clear();
        $rootScope.$broadcast('logged In');
        $interval(function() {
            $location.path('/')
        }, 3000, 1)
    };
}]);

/*
 Login controller
  */
app.controller('login', ['$rootScope','$scope', '$http', '$location', '$mdToast', function($rootScope, $scope, $http, $location, $mdToast){
    $scope.submit = function(username, password){
        $http.post('/authenticate', {username: username, password: password}).then(function(response){
                if(response.data.token){
                    sessionStorage.username = angular.toJson(response.data.user.username);
                    sessionStorage.email = angular.toJson(response.data.user.email);
                    sessionStorage.token = angular.toJson(response.data.token);
                    $location.path('/events');
                    $rootScope.$broadcast('logged In')
                }else{
                    $mdToast.showSimple(response.data.error)
                }

            }

        )
    };
    $scope.forgot = function(){
        $location.path('/forgot');
    }
}]);

/*
 Forgot controller
  */
app.controller('sendEmail', ['$scope', '$http', '$location', function($scope, $http, $location){
    $scope.send = function(email) {
        $http.post('/forgot', {email: email}).then(function (response) {
            if (response.status == 200) {
                $location.path('/')
            }
        })
    }
}]);

/*
 Profile controller
  */
app.controller('profile', ['$scope', '$http', '$window', '$location', function($scope, $http, $window, $location){
    $scope.username = $window.sessionStorage.username.replace(/^"(.*)"$/, '$1');
    $scope.email = $window.sessionStorage.email.replace(/^"(.*)"$/, '$1');
    $scope.save = function(password){
        var username = $scope.username;
        var email = $scope.email;
        $http.post('/change', {username: username, email: email, password: password}).then(function(response){
            if(response.status === 200){
                $location.path('/events')
            }
        });
    };
    $scope.switch = function(){
        var off = disabled;
        var on = enabled;

        if($scope.enabled = off){
            $scope.enabled = on
        } else {
            $scope.enabled = off;
        }
        console.log($scope.enabled)
    }
}]);

/*
 Reset controller
  */
app.controller('reset',['$scope', '$http', '$routeParams', '$location', function($scope, $http, $routeParams, $location){
    $scope.changePass = function(password, confirm){
        console.log(password);
        var token = $routeParams.token;
        if(password === confirm){
            $http.post('/reset', {password: password, token: token}).then(function(response){
                console.log(response);
                if(response.status === 200){
                    $location.path('/');
                }
            })
        }
    }
}]);

/*
Archived events controller
 */

/*
 Events list controller
  */
app.controller('eventsCtrl', ['$scope', '$http', '$filter', function($scope, $http, $filter) {
    $http.get('/api/event').then(function success(response) {

        // set get request to a variable
        eventsList = response.data;

        // initialize an empty array for storing data to be used in ng-repeat
        var tiles = [];

        // iterate over response data and push objects into array for ng-repeat
        eventsList.forEach(function(item, pos) {
            tiles.push({title: title = item.cohort + ' ' + item.type, date: $filter('date')(new Date(item.date), 'MM/dd/yy'), _id: item._id});
        });

        // set scope tiles equal to the object array
        $scope.tiles = tiles;

    }, function error() {});

}]);


app.controller('modalCtrl', ['$scope', '$mdDialog', function($scope, $mdDialog) {
    $scope.alert = '';

    $scope.showAlert = function (ev) {
        // Appending dialog to document.body to cover sidenav in docs app
        var confirm = $mdDialog.confirm()
            .title('You are about to Archive this Event!')
            .content('Click to confirm. You can access this Event at any time in Archived Events.')
            .ariaLabel('Archive')
            .targetEvent(ev)
            .ok('Got it!')
            .cancel('Nevermind.');

        $mdDialog.show(confirm).then(function () {
            $scope.status = 'You archived this event.';
        }, function () {
            $scope.status = 'You did not archive this event.';
        });
    };

    $scope.showConfirm = function (ev) {
        // Appending dialog to document.body to cover sidenav in docs app
        var confirm = $mdDialog.confirm()
            .title('Would you like to delete this Event?')
            .content('This will permanently delete this Event.')
            .ariaLabel('Delete')
            .targetEvent(ev)
            .ok('Yes, delete this Event!')
            .cancel('No way, that was close!');

        $mdDialog.show(confirm).then(function () {
            $scope.status = 'You deleted this event.';
        }, function () {
            $scope.status = 'You did not delete this event.';
        });
    };
}]);

/*
Generate event controller
 */
app.controller('generateCtrl', ['$scope', '$http', function($scope, $http) {

    // time experiments
    var startTime = moment('1:00 PM', 'h:mm A').format('HH:mm');
    var endTime = moment('4:00 PM', 'h:mm A').format('HH:mm');
    var eventLength = moment(endTime, 'HH:mm').diff(moment(startTime, 'HH:mm'), 'minutes');
    var slotLength = moment.duration((eventLength / 9), 'minutes').asMinutes();
    console.log(moment(startTime, 'HH:mm').add((slotLength * 8), 'minutes').format('h:mm A'));

    // Initialize UI Grid variables
    var gridCols = [];
    var gridData = [];

    // UI Grid options
    $scope.gridOptions = {
        enableSorting: false,
        enableGridMenu: true,
        enableFiltering: false,
        onRegisterApi: function (gridApi) {
            $scope.gridApi = gridApi;
        }
    };

    // "Generate" button click function
    $scope.generate = function () {

        // request matches from server given event settings
        $http({
            method: 'GET',
            url: 'http://localhost:3000/test'
        }).then(function successCallback(response) {

            // empty the UI Grid variables in case there is data
            $scope.gridOptions.columnDefs = [];
            $scope.gridOptions.data = [];
            gridCols = [];
            gridData = [];

            // console log API response for debugging
            console.log(response);

            // iterate over the interviewer array within the response
            // create various arrays and objects to meet UI Grid data requirements
            response.data.interviewer.forEach(function(item, pos) {

                // push the company and interviewer name into the column names array
                // this will be the column header for a particular interviewer
                gridCols.push({name: item.company + ' / ' + item.fName, field: item.company + '_' + item.name, width:150, displayName: item.company + ' / ' + item.fName});

                // set the scheduled object to a variable
                // this object contains the entire schedule for an interviewer
                var sched = item.scheduled;

                // initiate an empty students array
                // this will be used to store the formatted schedule for each company
                var students = [];

                // iterate over the scheduled object using the getOwnPropertyNames method
                Object.getOwnPropertyNames(sched).forEach(function (elem, index, array) {

                    // create an array of objects that contains each scheduled item
                    // this array will contain the formatted schedule for an interviewer
                    titleObj = {};
                    titleObj[item.company + '_' + item.fname] = sched[elem];
                    students.push(titleObj);
            });

            // push the updated schedule array into the master gridData array
            gridData.push(students);
            });

            // gridData is still not correctly formatted
            // each item represents an interviewer column
            // when in fact, UI Grid requires each item in the array to be a row of data
            // Underscore unzip function performs necessary matrix transformation
            gridData = _.unzip(gridData);

            // initiate empty array to store each row as an object of objects
            var gridArr = [];

            // iterate over unzipped gridData
            gridData.forEach(function (item, pos) {

                // initiate empty object for storing individual schedule items
                var rowObj = {};

                // iterate over the schedule row
                // each item in the row array represents a single cell in the grid
                item.forEach(function (elem, index) {
                    // use Underscore extend method to "push" each item into row object
                    _.extend(rowObj, elem);
                });

                // push the row object into the previously initiated grid array
                gridArr.push(rowObj);
            });

            // initiate an empty object for storing the entire schedule
            gridObj = {};

            // create time slots column
            var timeSlots = [];
            var slotsSize = gridArr.length;
            while(slotsSize--) {
                timeSlots.push({time: 'Slot ' + ((gridArr.length) - slotsSize)});
            }

            console.log(timeSlots);

            // using Underscore extend again, "push" the array of objects into the master object
            _.extend(gridObj, gridArr);

            // update the gridData variable
            gridData = gridArr;
        }).then(function() {

            // after capturing and formatting the data, update UI Grid options
            $scope.gridOptions.columnDefs = gridCols;
            $scope.gridOptions.data = gridData;
        })
    };
}]);

/*
 New event controller
  */
app.controller('newEventCtrl', ['$scope', '$http', '$location', '$filter', function($scope, $http, $location, $filter) {
    $scope.submit = function() {

        var event = {
            type: $scope.eventType,
            cohort: $scope.cohort,
            date: $scope.date,
            location: $scope.location,
            startTime: $filter('date')(new Date($scope.sTime), 'HH:mm'),
            endTime: $filter('date')(new Date($scope.eTime), 'HH:mm'),
            interviewDuration: $scope.slotDur,
            organizer: $scope.organizer
        };

        $http({
            method: 'POST',
            url: 'api/event',
            data: event
        }).then(function success(data) {
            console.log(data);
        }, function error() {}).then(function redirect() {
            $location.path('/events')
        })
    }
}]);
app.controller('addInterviewer', ['$scope', '$http', '$routeParams', function($scope, $http, $routeParams){
    $http.get('/api/interviewer').then(function (response) {
        console.log(response);
        $scope.interviewers = response.data;
    });
    $http.get('/api/event?_id='+$routeParams._id).then(function(response){
        var added = response.data[0].interviewers.slice();
        var interviewers = $scope.interviewers;
        for(var i = 0; i < interviewers.length; i++){
            var interviewer = interviewers[i];
            for(var j = 0; j < added.length; j++){
                if(interviewer._id === added[j]._id){
                    interviewer.added = true;
                }
            }
        }
        console.log($scope.added);
        console.log($scope.students);

    });

    var eventParam = $routeParams._id;
    $scope.eventId = eventParam;
    console.log(eventParam);
    console.log($routeParams);

    $scope.addInterviewer = function(id) {
        $http({
            method: 'POST',
            url: '/api/event/addInterviewer?_id=' + eventParam,
            data: {_id: id}
        }).then(function success(response) {
            var added = response.data.interviewers.slice();
            var interviewers = $scope.interviewers;
            for(var i = 0; i < interviewers.length; i++){
                var interviewer = interviewers[i];
                for(var j = 0; j < added.length; j++){
                    if(interviewer._id === added[j]._id){
                        interviewer.added = true;
                    }
                }
            }
        }, function error() {
        }).then(function redirect() {
            // hide row
        });
    };
    $scope.remove = function(id){
        var interviewers = $scope.interviewers;
        for(var i=0; i <interviewers.length; i++){
            var interviewer = interviewers[i];
            if(interviewer._id === id){
                interviewer.added = false;
            }
        }
        var event = $routeParams._id;
        $http.post('api/event/removeInterviewer?_id='+event, {_id: id}).then(function(response){
            console.log(response);
        })
    }
}]);
app.controller('addStudents', ['$scope', '$http', '$routeParams', function($scope, $http, $routeParams){
    $http.get('/api/student').then(function (response) {
        console.log(response);
        $scope.students = response.data;
    });
    $http.get('/api/event?_id='+$routeParams._id).then(function(response){
        var added = response.data[0].students.slice();
        var students = $scope.students;
        for(var i = 0; i < students.length; i++){
            var student = students[i];
            for(var j = 0; j < added.length; j++){
                if(student._id === added[j]._id){
                    student.added = true;
                }
            }
        }
        console.log($scope.added);
        console.log($scope.students);

    });

    var eventParam = $routeParams._id;
    $scope.eventId = eventParam;
    console.log(eventParam);
    console.log($routeParams);

    $scope.addStudent = function(id) {
        $http({
            method: 'POST',
            url: '/api/event/addStudent?_id=' + eventParam,
            data: {_id: id}
        }).then(function success(response) {
            var added = response.data.students.slice();
            var students = $scope.students;
            for(var i = 0; i < students.length; i++){
                var student = students[i];
                for(var j = 0; j < added.length; j++){
                    if(student._id === added[j]._id){
                        student.added = true;
                    }
                }
            }
        }, function error() {
        }).then(function redirect() {
            // hide row
        });
    };
    $scope.remove = function(id){
        var students = $scope.students;
        for(var i=0; i <students.length; i++){
            var student = students[i];
            if(student._id === id){
                student.added = false;
            }
        }
        var event = $routeParams._id;
        $http.post('api/event/removeStudent?_id='+event, {_id: id}).then(function(response){
            console.log(response);
        })
    }
}]);

/*
 View events controller
 */
app.controller('viewEventCtrl', ['$scope', '$http', '$filter', '$routeParams', function($scope, $http, $filter, $routeParams) {

    var eventParam = $routeParams._id;
    $scope.eventId = eventParam;

    $http.get('/api/event?_id=' + eventParam).then(function success(response) {

        $scope.eventTitle = response.data[0].cohort + ' ' + response.data[0].type;
        $scope.eventDate = $filter('date')(new Date(response.data[0].date), 'MM/dd/yy');
        $scope.eventStime = response.data[0].startTime;
        $scope.eventEtime = response.data[0].endTime;
        $scope.eventDur = response.data[0].interviewDuration;
        $scope.eventLoc = typeof response.data[0].location != 'undefined' ? response.data[0].location : 'NA';
        $scope.eventOrg = typeof response.data[0].organizer != 'undefined' ? response.data[0].organizer : 'NA';

    }, function error() {});

}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImludGVydmlld2Vycy9pbnRlcnZpZXdlcnMuY29udHJvbGxlci5qcyIsInN0dWRlbnRzL3N0dWRlbnRzLmNvbnRyb2xsZXIuanMiLCJob21lL2hvbWUuY29udHJvbGxlci5qcyIsImRpYWxvZ3Mvc3R1ZGVudC9zdHVkZW50LmNvbnRyb2xsZXIuanMiLCJkaWFsb2dzL2ludGVydmlld2VyL2ludGVydmlld2VyLmNvbnRyb2xsZXIuanMiLCJkaWFsb2dzL3VwbG9hZC91cGxvYWQuY29udHJvbGxlci5qcyIsImRpYWxvZ3MvcmVnaXN0ZXIvcmVnaXN0ZXIuY29udHJvbGxlci5qcyIsImFjY291bnQvbG9nb3V0L2xvZ291dC5jb250cm9sbGVyLmpzIiwiYWNjb3VudC9sb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwiYWNjb3VudC9mb3Jnb3QvZm9yZ290LmNvbnRyb2xsZXIuanMiLCJhY2NvdW50L3Byb2ZpbGUvcHJvZmlsZS5jb250cm9sbGVyLmpzIiwiYWNjb3VudC9yZXNldC9yZXNldC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2FyY2hpdmVkLWV2ZW50cy9hcmNoaXZlZC1ldmVudHMuY29udHJvbGxlci5qcyIsImV2ZW50cy9ldmVudHMtbGlzdC9ldmVudHMtbGlzdC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL3NjaGVkdWxlL3NjaGVkdWxlLmNvbnRyb2xsZXIuanMiLCJldmVudHMvbmV3LWV2ZW50L25ldy1ldmVudC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2FkZC1pbnRlcnZpZXdlcnMvYWRkLWludGVydmlld2Vycy5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2FkZC1zdHVkZW50cy9hZGQtc3R1ZGVudHMuY29udHJvbGxlci5qcyIsImV2ZW50cy92aWV3LWV2ZW50L3ZpZXctZXZlbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICduZ01lc3NhZ2VzJywgJ3VpLmdyaWQnLCAndWkuZ3JpZC5lZGl0JywgJ3VpLmdyaWQucm93RWRpdCcsICd1aS5ncmlkLmV4cG9ydGVyJywgJ25nRmlsZVVwbG9hZCddKTtcblxuLypcbiBBbmd1bGFyIGNvbmZpZ3VyYXRpb25cbiAqL1xuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRtZFRoZW1pbmdQcm92aWRlcicsIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJG1kVGhlbWluZ1Byb3ZpZGVyKXtcblxuICAgIC8vIENvbG9yIHBhbGV0dGVcbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ2JsdWUtZ3JleScpXG4gICAgICAgIC5hY2NlbnRQYWxldHRlKCdvcmFuZ2UnKTtcblxuICAgIC8vIEhUTUw1IG1vZGVcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xuICAgICAgICBlbmFibGVkOiB0cnVlXG4gICAgfSk7XG5cbiAgICAvLyBSb3V0ZXNcbiAgICAkcm91dGVQcm92aWRlci5cbiAgICAgICAgd2hlbignL2hvbWUnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2hvbWUvaG9tZS5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignLycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvYWNjb3VudC9sb2dpbi9sb2dpbi5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2ZvcmdvdCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvYWNjb3VudC9mb3Jnb3QvZm9yZ290Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvZXZlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9ldmVudHMvZXZlbnRzLWxpc3QvZXZlbnRzLWxpc3QuaHRtbCdcbiAgICAgICAgfSkuXG4gICAgICAgIHdoZW4oJy9ldmVudD86ZXZlbnRJZCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZXZlbnRzL3ZpZXctZXZlbnQvdmlldy1ldmVudC5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2V2ZW50L2FkZC1zdHVkZW50cz86ZXZlbnRJZCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZXZlbnRzL2FkZC1zdHVkZW50cy9hZGQtc3R1ZGVudHMuaHRtbCdcbiAgICAgICAgfSkuXG4gICAgICAgIHdoZW4oJy9ldmVudC9hZGQtaW50ZXJ2aWV3ZXJzPzpldmVudElkJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9ldmVudHMvYWRkLWludGVydmlld2Vycy9hZGQtaW50ZXJ2aWV3ZXJzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvZXZlbnQvc2NoZWR1bGU/OmV2ZW50SWQnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2V2ZW50cy9zY2hlZHVsZS9zY2hlZHVsZS5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL3N0dWRlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9zdHVkZW50cy9zdHVkZW50cy5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2ludGVydmlld2VycycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvaW50ZXJ2aWV3ZXJzL2ludGVydmlld2Vycy5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2FyY2hpdmVkLWV2ZW50cycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZXZlbnRzL2FyY2hpdmVkLWV2ZW50cy9hcmNoaXZlZC1ldmVudHMuaHRtbCdcbiAgICAgICAgfSkuXG4gICAgICAgIHdoZW4oJy9wcm9maWxlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9hY2NvdW50L3Byb2ZpbGUvcHJvZmlsZS5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2xvZ291dCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvYWNjb3VudC9sb2dvdXQvbG9nb3V0Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvbmV3LWV2ZW50Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9ldmVudHMvbmV3LWV2ZW50L25ldy1ldmVudC5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL3Jlc2V0Lzp0b2tlbicsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvYWNjb3VudC9yZXNldC9yZXNldC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZXNldCdcbiAgICAgICAgfSkuXG4gICAgICAgIG90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICB9KVxufV0pO1xuXG4vKlxuVG9vbGJhciBjb250cm9sbGVyXG4gKi9cbmFwcC5jb250cm9sbGVyKCd0b29sYmFyJywgWyckcm9vdFNjb3BlJywnJGxvY2F0aW9uJywnJHNjb3BlJywgJyR3aW5kb3cnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRzY29wZSwgJHdpbmRvdyl7XG4gICAgJHNjb3BlLnBhdGhzID0gdHJ1ZTtcbiAgICAkcm9vdFNjb3BlLiRvbignbG9nZ2VkIEluJywgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYoJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbiA9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgJHNjb3BlLnBhdGhzID0gdHJ1ZTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAkc2NvcGUucGF0aHMgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS51c2VyID0ge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkd2luZG93LnNlc3Npb25TdG9yYWdlLnVzZXJuYW1lLnJlcGxhY2UoL15cIiguKilcIiQvLCAnJDEnKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgICRzY29wZS5nb0hvbWUgPSBmdW5jdGlvbigpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgIH1cbn1dKTtcblxuLypcbkRpcmVjdGl2ZSB0byBjaGVjayB0aGUgcGFzc3dvcmRzIGFyZSB0aGUgc2FtZVxuICovXG5hcHAuZGlyZWN0aXZlKFwicGFzc3dvcmRWZXJpZnlcIiwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWlyZTogXCJuZ01vZGVsXCIsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBwYXNzd29yZFZlcmlmeTogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBjb21iaW5lZDtcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucGFzc3dvcmRWZXJpZnkgfHwgY3RybC4kdmlld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbWJpbmVkID0gc2NvcGUucGFzc3dvcmRWZXJpZnkgKyAnXycgKyBjdHJsLiR2aWV3VmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjb21iaW5lZDtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHBhcnNlcnMudW5zaGlmdChmdW5jdGlvbih2aWV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSBzY29wZS5wYXNzd29yZFZlcmlmeTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW4gIT09IHZpZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KFwicGFzc3dvcmRWZXJpZnlcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KFwicGFzc3dvcmRWZXJpZnlcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufSk7IiwiYXBwLmNvbnRyb2xsZXIoJ2ludGVydmlld2VycycsIFsnJHNjb3BlJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCl7XG4gICRodHRwLmdldCgnL2FwaS9pbnRlcnZpZXdlcicpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgJHNjb3BlLmludGVydmlld2VycyA9IHJlc3BvbnNlLmRhdGFcbiAgfSk7XG4gJHNjb3BlLmVkaXRJbnRlcnZpZXdlciA9IGZ1bmN0aW9uKGlkKSB7XG4gICRodHRwLmdldCgnL2FwaS9pbnRlcnZpZXdlcj9faWQ9JyArIGlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgJHNjb3BlLmludGVydmlld2VyID0gcmVzcG9uc2UuZGF0YVswXTtcbiAgICRtZERpYWxvZy5zaG93KHtcbiAgICBjb250cm9sbGVyOiAnZWRpdEludGVydmlld2VyJyxcbiAgICBsb2NhbHM6IHtcbiAgICAgaXRlbXM6ICRzY29wZS5pbnRlcnZpZXdlclxuICAgIH0sXG4gICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL2ludGVydmlld2VyL2ludGVydmlld2VyRWRpdC5odG1sJyxcbiAgICBwYXJlbnQ6IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5ib2R5KSxcbiAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICB9KVxuICB9KVxuIH1cbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2VkaXRJbnRlcnZpZXdlcicsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsICdpdGVtcycsIGZ1bmN0aW9uKCRzY29wZSwgJG1kRGlhbG9nLCBpdGVtcyl7XG4gJHNjb3BlLmludGVydmlld2VyID0gaXRlbXM7XG4gY29uc29sZS5sb2coaXRlbXMpO1xuXG4gJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKXtcbiAgJG1kRGlhbG9nLmhpZGUoKTtcbiB9XG59XSk7IiwiYXBwLmNvbnRyb2xsZXIoJ3N0dWRlbnRzJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJG1kRGlhbG9nKXtcbiAgICAkaHR0cC5nZXQoJy9hcGkvc3R1ZGVudCcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICRzY29wZS5zdHVkZW50cyA9IHJlc3BvbnNlLmRhdGFcbiAgICB9KTtcblxuICAgICRzY29wZS5lZGl0U3R1ZGVudCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS9zdHVkZW50P19pZD0nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3R1ZGVudCA9IHJlc3BvbnNlLmRhdGFbMF07XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVsbG8nKTtcbiAgICAgICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnZWRpdFN0dWRlbnQnLFxuICAgICAgICAgICAgICAgIGxvY2Fsczoge1xuICAgICAgICAgICAgICAgICAgICBpdGVtczogJHNjb3BlLnN0dWRlbnRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy9zdHVkZW50L3N0dWRlbnRFZGl0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxuICAgICAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfTtcbn1dKTtcbmFwcC5jb250cm9sbGVyKCdlZGl0U3R1ZGVudCcsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsICdpdGVtcycsIGZ1bmN0aW9uKCRzY29wZSwgJG1kRGlhbG9nLCBpdGVtcyl7XG4gICAgJHNjb3BlLnN0dWRlbnQgPSBpdGVtcztcblxuICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgfVxufV0pOyIsIlxuLypcbkhvbWUgY29udHJvbGxlclxuICovIiwiXG4vKlxuU3R1ZGVudCBkaWFsb2cgY29udHJvbGxlclxuICovXG5hcHAuY29udHJvbGxlcignc3R1ZGVudCcsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsIGZ1bmN0aW9uKCRzY29wZSwkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuU3R1ZGVudHMgPSBmdW5jdGlvbihldil7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGFkZFN0dWRlbnQsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2RpYWxvZ3Mvc3R1ZGVudC9zdHVkZW50Lmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiBhZGRTdHVkZW50KCRzY29wZSkge1xuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmllcyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ1ByaW1lJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdOZXJkZXJ5J30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdEaWdpdGFsIFBlb3BsZSd9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgJHNjb3BlLmV2ZW50cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIERlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdjYXJlZXIgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIEVwc2lsb24nfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKGZuYW1lLCBsbmFtZSwgZW1haWwsIGNvaG9ydCl7XG4gICAgICAgICAgICB2YXIgc3R1ZGVudCA9IHtcbiAgICAgICAgICAgICAgICBmbmFtZTogZm5hbWUsXG4gICAgICAgICAgICAgICAgbG5hbWU6IGxuYW1lLFxuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBjb2hvcnQ6IGNvaG9ydFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0dWRlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG59XSk7IiwiXG4vKlxuSW50ZXJ2aWV3ZXIgZGlhbG9nIGNvbnRyb2xsZXJcbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ2ludGVydmlld2VyJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuSW50ZXJ2aWV3ZXIgPSBmdW5jdGlvbihldil7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGFkZEludGVydmlld2VyLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL2ludGVydmlld2VyL2ludGVydmlld2VyLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiBhZGRJbnRlcnZpZXdlcigkc2NvcGUpe1xuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuY29ob3J0cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ0RlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdnYW1tYSd9LFxuICAgICAgICAgICAgICAgIHtuYW1lOiAnRXBzaWxvbid9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgJHNjb3BlLmV2ZW50cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIERlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdjYXJlZXIgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIEVwc2lsb24nfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKGZuYW1lLCBsbmFtZSwgdGl0bGUsIGNvbXBhbnksIGxpbmssIGRlc2Mpe1xuICAgICAgICAgICAgdmFyIGludGVydmlld2VyID0ge1xuICAgICAgICAgICAgICAgIGZOYW1lOiBmbmFtZSxcbiAgICAgICAgICAgICAgICBsTmFtZTogbG5hbWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgICAgIGNvbXBhbnk6IGNvbXBhbnksXG4gICAgICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGludGVydmlld2VyKTtcbiAgICAgICAgfTtcbiAgICB9XG59XSk7IiwiXG4vKlxuU3R1ZGVudCBkaWFsb2cgY29udHJvbGxlclxuICovXG5hcHAuY29udHJvbGxlcigndXBsb2FkcycsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsICdVcGxvYWQnLCAnJHJvdXRlUGFyYW1zJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJG1kRGlhbG9nLCBVcGxvYWQsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLm9wZW5VcGxvYWRzID0gZnVuY3Rpb24oZXYpe1xuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICBjb250cm9sbGVyOiB1cGxvYWRGaWxlLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL3VwbG9hZC91cGxvYWQuaHRtbCcsXG4gICAgICAgICAgICBwYXJlbnQ6IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5ib2R5KSxcbiAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldixcbiAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWVcbiAgICAgICAgfSlcbiAgICB9O1xuICAgIGZ1bmN0aW9uIHVwbG9hZEZpbGUoJHNjb3BlLCAkbWREaWFsb2csIFVwbG9hZCwgJGxvY2F0aW9uKXtcblxuICAgICAgICB2YXIgdGFyZ2V0ID0gJGxvY2F0aW9uLnBhdGgoKTtcblxuICAgICAgICAvLyB1cGxvYWQgb24gZmlsZSBzZWxlY3Qgb3IgZHJvcFxuICAgICAgICAkc2NvcGUudXBsb2FkID0gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgIFVwbG9hZC51cGxvYWQoe1xuICAgICAgICAgICAgICAgIHVybDogJy9hcGkvdXBsb2FkJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7ZmlsZTogZmlsZSwgdGFyZ2V0OiB0YXJnZXR9XG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3MgJyArIHJlc3AuY29uZmlnLmRhdGEuZmlsZS5uYW1lICsgJ3VwbG9hZGVkLiBSZXNwb25zZTogJyArIHJlc3AuZGF0YSk7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHN0YXR1czogJyArIHJlc3Auc3RhdHVzKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvZ3Jlc3NQZXJjZW50YWdlID0gcGFyc2VJbnQoMTAwLjAgKiBldnQubG9hZGVkIC8gZXZ0LnRvdGFsKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncHJvZ3Jlc3M6ICcgKyBwcm9ncmVzc1BlcmNlbnRhZ2UgKyAnJSAnICsgZXZ0LmNvbmZpZy5kYXRhLmZpbGUubmFtZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG59XSk7IiwiXG4vKlxuUmVnaXN0ZXIgZGlhbG9nIGNvbnRyb2xsZXJcbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyT3BlbicsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJG1kRGlhbG9nKXtcbiAgICAkc2NvcGUub3BlblJlZ2lzdGVyID0gZnVuY3Rpb24oZXYpe1xuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICBjb250cm9sbGVyOiByZWdpc3RlcixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy9yZWdpc3Rlci9yZWdpc3Rlci5odG1sJyxcbiAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxuICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZVxuICAgICAgICB9KVxuICAgIH07XG4gICAgZnVuY3Rpb24gcmVnaXN0ZXIoJHNjb3BlLCAkaHR0cCwgJG1kRGlhbG9nKSB7XG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQpe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9O1xuICAgIH1cbn1dKTsiLCJcbi8qXG4gTG9nb3V0IGNvbnRyb2xsZXJcbiAgKi9cbmFwcC5jb250cm9sbGVyKCdsb2dvdXQnLCBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywnJGxvY2F0aW9uJywgJyRpbnRlcnZhbCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkaW50ZXJ2YWwpe1xuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ291dCcpO1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5jbGVhcigpO1xuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZCBJbicpO1xuICAgICAgICAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXG4gICAgICAgIH0sIDMwMDAsIDEpXG4gICAgfTtcbn1dKTsiLCJcbi8qXG4gTG9naW4gY29udHJvbGxlclxuICAqL1xuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luJywgWyckcm9vdFNjb3BlJywnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICckbWRUb2FzdCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgJG1kVG9hc3Qpe1xuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXV0aGVudGljYXRlJywge3VzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS50b2tlbil7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnVzZXJuYW1lID0gYW5ndWxhci50b0pzb24ocmVzcG9uc2UuZGF0YS51c2VyLnVzZXJuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UuZW1haWwgPSBhbmd1bGFyLnRvSnNvbihyZXNwb25zZS5kYXRhLnVzZXIuZW1haWwpO1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS50b2tlbiA9IGFuZ3VsYXIudG9Kc29uKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50cycpO1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZCBJbicpXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICRtZFRvYXN0LnNob3dTaW1wbGUocmVzcG9uc2UuZGF0YS5lcnJvcilcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICApXG4gICAgfTtcbiAgICAkc2NvcGUuZm9yZ290ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9mb3Jnb3QnKTtcbiAgICB9XG59XSk7IiwiXG4vKlxuIEZvcmdvdCBjb250cm9sbGVyXG4gICovXG5hcHAuY29udHJvbGxlcignc2VuZEVtYWlsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUuc2VuZCA9IGZ1bmN0aW9uKGVtYWlsKSB7XG4gICAgICAgICRodHRwLnBvc3QoJy9mb3Jnb3QnLCB7ZW1haWw6IGVtYWlsfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cbn1dKTsiLCJcbi8qXG4gUHJvZmlsZSBjb250cm9sbGVyXG4gICovXG5hcHAuY29udHJvbGxlcigncHJvZmlsZScsIFsnJHNjb3BlJywgJyRodHRwJywgJyR3aW5kb3cnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHdpbmRvdywgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUudXNlcm5hbWUgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlLnVzZXJuYW1lLnJlcGxhY2UoL15cIiguKilcIiQvLCAnJDEnKTtcbiAgICAkc2NvcGUuZW1haWwgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlLmVtYWlsLnJlcGxhY2UoL15cIiguKilcIiQvLCAnJDEnKTtcbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKHBhc3N3b3JkKXtcbiAgICAgICAgdmFyIHVzZXJuYW1lID0gJHNjb3BlLnVzZXJuYW1lO1xuICAgICAgICB2YXIgZW1haWwgPSAkc2NvcGUuZW1haWw7XG4gICAgICAgICRodHRwLnBvc3QoJy9jaGFuZ2UnLCB7dXNlcm5hbWU6IHVzZXJuYW1lLCBlbWFpbDogZW1haWwsIHBhc3N3b3JkOiBwYXNzd29yZH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApe1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAkc2NvcGUuc3dpdGNoID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG9mZiA9IGRpc2FibGVkO1xuICAgICAgICB2YXIgb24gPSBlbmFibGVkO1xuXG4gICAgICAgIGlmKCRzY29wZS5lbmFibGVkID0gb2ZmKXtcbiAgICAgICAgICAgICRzY29wZS5lbmFibGVkID0gb25cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRzY29wZS5lbmFibGVkID0gb2ZmO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5lbmFibGVkKVxuICAgIH1cbn1dKTsiLCJcbi8qXG4gUmVzZXQgY29udHJvbGxlclxuICAqL1xuYXBwLmNvbnRyb2xsZXIoJ3Jlc2V0JyxbJyRzY29wZScsICckaHR0cCcsICckcm91dGVQYXJhbXMnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS5jaGFuZ2VQYXNzID0gZnVuY3Rpb24ocGFzc3dvcmQsIGNvbmZpcm0pe1xuICAgICAgICBjb25zb2xlLmxvZyhwYXNzd29yZCk7XG4gICAgICAgIHZhciB0b2tlbiA9ICRyb3V0ZVBhcmFtcy50b2tlbjtcbiAgICAgICAgaWYocGFzc3dvcmQgPT09IGNvbmZpcm0pe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3Jlc2V0Jywge3Bhc3N3b3JkOiBwYXNzd29yZCwgdG9rZW46IHRva2VufSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxufV0pOyIsIlxuLypcbkFyY2hpdmVkIGV2ZW50cyBjb250cm9sbGVyXG4gKi8iLCJcbi8qXG4gRXZlbnRzIGxpc3QgY29udHJvbGxlclxuICAqL1xuYXBwLmNvbnRyb2xsZXIoJ2V2ZW50c0N0cmwnLCBbJyRzY29wZScsICckaHR0cCcsICckZmlsdGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGZpbHRlcikge1xuICAgICRodHRwLmdldCgnL2FwaS9ldmVudCcpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSkge1xuXG4gICAgICAgIC8vIHNldCBnZXQgcmVxdWVzdCB0byBhIHZhcmlhYmxlXG4gICAgICAgIGV2ZW50c0xpc3QgPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW4gZW1wdHkgYXJyYXkgZm9yIHN0b3JpbmcgZGF0YSB0byBiZSB1c2VkIGluIG5nLXJlcGVhdFxuICAgICAgICB2YXIgdGlsZXMgPSBbXTtcblxuICAgICAgICAvLyBpdGVyYXRlIG92ZXIgcmVzcG9uc2UgZGF0YSBhbmQgcHVzaCBvYmplY3RzIGludG8gYXJyYXkgZm9yIG5nLXJlcGVhdFxuICAgICAgICBldmVudHNMaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSwgcG9zKSB7XG4gICAgICAgICAgICB0aWxlcy5wdXNoKHt0aXRsZTogdGl0bGUgPSBpdGVtLmNvaG9ydCArICcgJyArIGl0ZW0udHlwZSwgZGF0ZTogJGZpbHRlcignZGF0ZScpKG5ldyBEYXRlKGl0ZW0uZGF0ZSksICdNTS9kZC95eScpLCBfaWQ6IGl0ZW0uX2lkfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNldCBzY29wZSB0aWxlcyBlcXVhbCB0byB0aGUgb2JqZWN0IGFycmF5XG4gICAgICAgICRzY29wZS50aWxlcyA9IHRpbGVzO1xuXG4gICAgfSwgZnVuY3Rpb24gZXJyb3IoKSB7fSk7XG5cbn1dKTtcblxuXG5hcHAuY29udHJvbGxlcignbW9kYWxDdHJsJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpIHtcbiAgICAkc2NvcGUuYWxlcnQgPSAnJztcblxuICAgICRzY29wZS5zaG93QWxlcnQgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgLy8gQXBwZW5kaW5nIGRpYWxvZyB0byBkb2N1bWVudC5ib2R5IHRvIGNvdmVyIHNpZGVuYXYgaW4gZG9jcyBhcHBcbiAgICAgICAgdmFyIGNvbmZpcm0gPSAkbWREaWFsb2cuY29uZmlybSgpXG4gICAgICAgICAgICAudGl0bGUoJ1lvdSBhcmUgYWJvdXQgdG8gQXJjaGl2ZSB0aGlzIEV2ZW50IScpXG4gICAgICAgICAgICAuY29udGVudCgnQ2xpY2sgdG8gY29uZmlybS4gWW91IGNhbiBhY2Nlc3MgdGhpcyBFdmVudCBhdCBhbnkgdGltZSBpbiBBcmNoaXZlZCBFdmVudHMuJylcbiAgICAgICAgICAgIC5hcmlhTGFiZWwoJ0FyY2hpdmUnKVxuICAgICAgICAgICAgLnRhcmdldEV2ZW50KGV2KVxuICAgICAgICAgICAgLm9rKCdHb3QgaXQhJylcbiAgICAgICAgICAgIC5jYW5jZWwoJ05ldmVybWluZC4nKTtcblxuICAgICAgICAkbWREaWFsb2cuc2hvdyhjb25maXJtKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5zdGF0dXMgPSAnWW91IGFyY2hpdmVkIHRoaXMgZXZlbnQuJztcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnN0YXR1cyA9ICdZb3UgZGlkIG5vdCBhcmNoaXZlIHRoaXMgZXZlbnQuJztcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zaG93Q29uZmlybSA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICAvLyBBcHBlbmRpbmcgZGlhbG9nIHRvIGRvY3VtZW50LmJvZHkgdG8gY292ZXIgc2lkZW5hdiBpbiBkb2NzIGFwcFxuICAgICAgICB2YXIgY29uZmlybSA9ICRtZERpYWxvZy5jb25maXJtKClcbiAgICAgICAgICAgIC50aXRsZSgnV291bGQgeW91IGxpa2UgdG8gZGVsZXRlIHRoaXMgRXZlbnQ/JylcbiAgICAgICAgICAgIC5jb250ZW50KCdUaGlzIHdpbGwgcGVybWFuZW50bHkgZGVsZXRlIHRoaXMgRXZlbnQuJylcbiAgICAgICAgICAgIC5hcmlhTGFiZWwoJ0RlbGV0ZScpXG4gICAgICAgICAgICAudGFyZ2V0RXZlbnQoZXYpXG4gICAgICAgICAgICAub2soJ1llcywgZGVsZXRlIHRoaXMgRXZlbnQhJylcbiAgICAgICAgICAgIC5jYW5jZWwoJ05vIHdheSwgdGhhdCB3YXMgY2xvc2UhJyk7XG5cbiAgICAgICAgJG1kRGlhbG9nLnNob3coY29uZmlybSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1lvdSBkZWxldGVkIHRoaXMgZXZlbnQuJztcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnN0YXR1cyA9ICdZb3UgZGlkIG5vdCBkZWxldGUgdGhpcyBldmVudC4nO1xuICAgICAgICB9KTtcbiAgICB9O1xufV0pOyIsIlxuLypcbkdlbmVyYXRlIGV2ZW50IGNvbnRyb2xsZXJcbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ2dlbmVyYXRlQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCkge1xuXG4gICAgLy8gdGltZSBleHBlcmltZW50c1xuICAgIHZhciBzdGFydFRpbWUgPSBtb21lbnQoJzE6MDAgUE0nLCAnaDptbSBBJykuZm9ybWF0KCdISDptbScpO1xuICAgIHZhciBlbmRUaW1lID0gbW9tZW50KCc0OjAwIFBNJywgJ2g6bW0gQScpLmZvcm1hdCgnSEg6bW0nKTtcbiAgICB2YXIgZXZlbnRMZW5ndGggPSBtb21lbnQoZW5kVGltZSwgJ0hIOm1tJykuZGlmZihtb21lbnQoc3RhcnRUaW1lLCAnSEg6bW0nKSwgJ21pbnV0ZXMnKTtcbiAgICB2YXIgc2xvdExlbmd0aCA9IG1vbWVudC5kdXJhdGlvbigoZXZlbnRMZW5ndGggLyA5KSwgJ21pbnV0ZXMnKS5hc01pbnV0ZXMoKTtcbiAgICBjb25zb2xlLmxvZyhtb21lbnQoc3RhcnRUaW1lLCAnSEg6bW0nKS5hZGQoKHNsb3RMZW5ndGggKiA4KSwgJ21pbnV0ZXMnKS5mb3JtYXQoJ2g6bW0gQScpKTtcblxuICAgIC8vIEluaXRpYWxpemUgVUkgR3JpZCB2YXJpYWJsZXNcbiAgICB2YXIgZ3JpZENvbHMgPSBbXTtcbiAgICB2YXIgZ3JpZERhdGEgPSBbXTtcblxuICAgIC8vIFVJIEdyaWQgb3B0aW9uc1xuICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IHtcbiAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgIGVuYWJsZUdyaWRNZW51OiB0cnVlLFxuICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICBvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIFwiR2VuZXJhdGVcIiBidXR0b24gY2xpY2sgZnVuY3Rpb25cbiAgICAkc2NvcGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLy8gcmVxdWVzdCBtYXRjaGVzIGZyb20gc2VydmVyIGdpdmVuIGV2ZW50IHNldHRpbmdzXG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvdGVzdCdcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgLy8gZW1wdHkgdGhlIFVJIEdyaWQgdmFyaWFibGVzIGluIGNhc2UgdGhlcmUgaXMgZGF0YVxuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgICAgICBncmlkQ29scyA9IFtdO1xuICAgICAgICAgICAgZ3JpZERhdGEgPSBbXTtcblxuICAgICAgICAgICAgLy8gY29uc29sZSBsb2cgQVBJIHJlc3BvbnNlIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBpbnRlcnZpZXdlciBhcnJheSB3aXRoaW4gdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICAvLyBjcmVhdGUgdmFyaW91cyBhcnJheXMgYW5kIG9iamVjdHMgdG8gbWVldCBVSSBHcmlkIGRhdGEgcmVxdWlyZW1lbnRzXG4gICAgICAgICAgICByZXNwb25zZS5kYXRhLmludGVydmlld2VyLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgcG9zKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBwdXNoIHRoZSBjb21wYW55IGFuZCBpbnRlcnZpZXdlciBuYW1lIGludG8gdGhlIGNvbHVtbiBuYW1lcyBhcnJheVxuICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBiZSB0aGUgY29sdW1uIGhlYWRlciBmb3IgYSBwYXJ0aWN1bGFyIGludGVydmlld2VyXG4gICAgICAgICAgICAgICAgZ3JpZENvbHMucHVzaCh7bmFtZTogaXRlbS5jb21wYW55ICsgJyAvICcgKyBpdGVtLmZOYW1lLCBmaWVsZDogaXRlbS5jb21wYW55ICsgJ18nICsgaXRlbS5uYW1lLCB3aWR0aDoxNTAsIGRpc3BsYXlOYW1lOiBpdGVtLmNvbXBhbnkgKyAnIC8gJyArIGl0ZW0uZk5hbWV9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgc2NoZWR1bGVkIG9iamVjdCB0byBhIHZhcmlhYmxlXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBvYmplY3QgY29udGFpbnMgdGhlIGVudGlyZSBzY2hlZHVsZSBmb3IgYW4gaW50ZXJ2aWV3ZXJcbiAgICAgICAgICAgICAgICB2YXIgc2NoZWQgPSBpdGVtLnNjaGVkdWxlZDtcblxuICAgICAgICAgICAgICAgIC8vIGluaXRpYXRlIGFuIGVtcHR5IHN0dWRlbnRzIGFycmF5XG4gICAgICAgICAgICAgICAgLy8gdGhpcyB3aWxsIGJlIHVzZWQgdG8gc3RvcmUgdGhlIGZvcm1hdHRlZCBzY2hlZHVsZSBmb3IgZWFjaCBjb21wYW55XG4gICAgICAgICAgICAgICAgdmFyIHN0dWRlbnRzID0gW107XG5cbiAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIHNjaGVkdWxlZCBvYmplY3QgdXNpbmcgdGhlIGdldE93blByb3BlcnR5TmFtZXMgbWV0aG9kXG4gICAgICAgICAgICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoc2NoZWQpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGluZGV4LCBhcnJheSkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgY29udGFpbnMgZWFjaCBzY2hlZHVsZWQgaXRlbVxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGFycmF5IHdpbGwgY29udGFpbiB0aGUgZm9ybWF0dGVkIHNjaGVkdWxlIGZvciBhbiBpbnRlcnZpZXdlclxuICAgICAgICAgICAgICAgICAgICB0aXRsZU9iaiA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB0aXRsZU9ialtpdGVtLmNvbXBhbnkgKyAnXycgKyBpdGVtLmZuYW1lXSA9IHNjaGVkW2VsZW1dO1xuICAgICAgICAgICAgICAgICAgICBzdHVkZW50cy5wdXNoKHRpdGxlT2JqKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBwdXNoIHRoZSB1cGRhdGVkIHNjaGVkdWxlIGFycmF5IGludG8gdGhlIG1hc3RlciBncmlkRGF0YSBhcnJheVxuICAgICAgICAgICAgZ3JpZERhdGEucHVzaChzdHVkZW50cyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gZ3JpZERhdGEgaXMgc3RpbGwgbm90IGNvcnJlY3RseSBmb3JtYXR0ZWRcbiAgICAgICAgICAgIC8vIGVhY2ggaXRlbSByZXByZXNlbnRzIGFuIGludGVydmlld2VyIGNvbHVtblxuICAgICAgICAgICAgLy8gd2hlbiBpbiBmYWN0LCBVSSBHcmlkIHJlcXVpcmVzIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkgdG8gYmUgYSByb3cgb2YgZGF0YVxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZSB1bnppcCBmdW5jdGlvbiBwZXJmb3JtcyBuZWNlc3NhcnkgbWF0cml4IHRyYW5zZm9ybWF0aW9uXG4gICAgICAgICAgICBncmlkRGF0YSA9IF8udW56aXAoZ3JpZERhdGEpO1xuXG4gICAgICAgICAgICAvLyBpbml0aWF0ZSBlbXB0eSBhcnJheSB0byBzdG9yZSBlYWNoIHJvdyBhcyBhbiBvYmplY3Qgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgdmFyIGdyaWRBcnIgPSBbXTtcblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHVuemlwcGVkIGdyaWREYXRhXG4gICAgICAgICAgICBncmlkRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBwb3MpIHtcblxuICAgICAgICAgICAgICAgIC8vIGluaXRpYXRlIGVtcHR5IG9iamVjdCBmb3Igc3RvcmluZyBpbmRpdmlkdWFsIHNjaGVkdWxlIGl0ZW1zXG4gICAgICAgICAgICAgICAgdmFyIHJvd09iaiA9IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBzY2hlZHVsZSByb3dcbiAgICAgICAgICAgICAgICAvLyBlYWNoIGl0ZW0gaW4gdGhlIHJvdyBhcnJheSByZXByZXNlbnRzIGEgc2luZ2xlIGNlbGwgaW4gdGhlIGdyaWRcbiAgICAgICAgICAgICAgICBpdGVtLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZSBVbmRlcnNjb3JlIGV4dGVuZCBtZXRob2QgdG8gXCJwdXNoXCIgZWFjaCBpdGVtIGludG8gcm93IG9iamVjdFxuICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZChyb3dPYmosIGVsZW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gcHVzaCB0aGUgcm93IG9iamVjdCBpbnRvIHRoZSBwcmV2aW91c2x5IGluaXRpYXRlZCBncmlkIGFycmF5XG4gICAgICAgICAgICAgICAgZ3JpZEFyci5wdXNoKHJvd09iaik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaW5pdGlhdGUgYW4gZW1wdHkgb2JqZWN0IGZvciBzdG9yaW5nIHRoZSBlbnRpcmUgc2NoZWR1bGVcbiAgICAgICAgICAgIGdyaWRPYmogPSB7fTtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIHRpbWUgc2xvdHMgY29sdW1uXG4gICAgICAgICAgICB2YXIgdGltZVNsb3RzID0gW107XG4gICAgICAgICAgICB2YXIgc2xvdHNTaXplID0gZ3JpZEFyci5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZShzbG90c1NpemUtLSkge1xuICAgICAgICAgICAgICAgIHRpbWVTbG90cy5wdXNoKHt0aW1lOiAnU2xvdCAnICsgKChncmlkQXJyLmxlbmd0aCkgLSBzbG90c1NpemUpfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRpbWVTbG90cyk7XG5cbiAgICAgICAgICAgIC8vIHVzaW5nIFVuZGVyc2NvcmUgZXh0ZW5kIGFnYWluLCBcInB1c2hcIiB0aGUgYXJyYXkgb2Ygb2JqZWN0cyBpbnRvIHRoZSBtYXN0ZXIgb2JqZWN0XG4gICAgICAgICAgICBfLmV4dGVuZChncmlkT2JqLCBncmlkQXJyKTtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBncmlkRGF0YSB2YXJpYWJsZVxuICAgICAgICAgICAgZ3JpZERhdGEgPSBncmlkQXJyO1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBhZnRlciBjYXB0dXJpbmcgYW5kIGZvcm1hdHRpbmcgdGhlIGRhdGEsIHVwZGF0ZSBVSSBHcmlkIG9wdGlvbnNcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZENvbHM7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IGdyaWREYXRhO1xuICAgICAgICB9KVxuICAgIH07XG59XSk7IiwiXG4vKlxuIE5ldyBldmVudCBjb250cm9sbGVyXG4gICovXG5hcHAuY29udHJvbGxlcignbmV3RXZlbnRDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJyRmaWx0ZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sICRmaWx0ZXIpIHtcbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIGV2ZW50ID0ge1xuICAgICAgICAgICAgdHlwZTogJHNjb3BlLmV2ZW50VHlwZSxcbiAgICAgICAgICAgIGNvaG9ydDogJHNjb3BlLmNvaG9ydCxcbiAgICAgICAgICAgIGRhdGU6ICRzY29wZS5kYXRlLFxuICAgICAgICAgICAgbG9jYXRpb246ICRzY29wZS5sb2NhdGlvbixcbiAgICAgICAgICAgIHN0YXJ0VGltZTogJGZpbHRlcignZGF0ZScpKG5ldyBEYXRlKCRzY29wZS5zVGltZSksICdISDptbScpLFxuICAgICAgICAgICAgZW5kVGltZTogJGZpbHRlcignZGF0ZScpKG5ldyBEYXRlKCRzY29wZS5lVGltZSksICdISDptbScpLFxuICAgICAgICAgICAgaW50ZXJ2aWV3RHVyYXRpb246ICRzY29wZS5zbG90RHVyLFxuICAgICAgICAgICAgb3JnYW5pemVyOiAkc2NvcGUub3JnYW5pemVyXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICdhcGkvZXZlbnQnLFxuICAgICAgICAgICAgZGF0YTogZXZlbnRcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcigpIHt9KS50aGVuKGZ1bmN0aW9uIHJlZGlyZWN0KCkge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudHMnKVxuICAgICAgICB9KVxuICAgIH1cbn1dKTsiLCJhcHAuY29udHJvbGxlcignYWRkSW50ZXJ2aWV3ZXInLCBbJyRzY29wZScsICckaHR0cCcsICckcm91dGVQYXJhbXMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpe1xuICAgICRodHRwLmdldCgnL2FwaS9pbnRlcnZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgJHNjb3BlLmludGVydmlld2VycyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgfSk7XG4gICAgJGh0dHAuZ2V0KCcvYXBpL2V2ZW50P19pZD0nKyRyb3V0ZVBhcmFtcy5faWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICB2YXIgYWRkZWQgPSByZXNwb25zZS5kYXRhWzBdLmludGVydmlld2Vycy5zbGljZSgpO1xuICAgICAgICB2YXIgaW50ZXJ2aWV3ZXJzID0gJHNjb3BlLmludGVydmlld2VycztcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGludGVydmlld2Vycy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICB2YXIgaW50ZXJ2aWV3ZXIgPSBpbnRlcnZpZXdlcnNbaV07XG4gICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgYWRkZWQubGVuZ3RoOyBqKyspe1xuICAgICAgICAgICAgICAgIGlmKGludGVydmlld2VyLl9pZCA9PT0gYWRkZWRbal0uX2lkKXtcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJ2aWV3ZXIuYWRkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuYWRkZWQpO1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuc3R1ZGVudHMpO1xuXG4gICAgfSk7XG5cbiAgICB2YXIgZXZlbnRQYXJhbSA9ICRyb3V0ZVBhcmFtcy5faWQ7XG4gICAgJHNjb3BlLmV2ZW50SWQgPSBldmVudFBhcmFtO1xuICAgIGNvbnNvbGUubG9nKGV2ZW50UGFyYW0pO1xuICAgIGNvbnNvbGUubG9nKCRyb3V0ZVBhcmFtcyk7XG5cbiAgICAkc2NvcGUuYWRkSW50ZXJ2aWV3ZXIgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJy9hcGkvZXZlbnQvYWRkSW50ZXJ2aWV3ZXI/X2lkPScgKyBldmVudFBhcmFtLFxuICAgICAgICAgICAgZGF0YToge19pZDogaWR9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGFkZGVkID0gcmVzcG9uc2UuZGF0YS5pbnRlcnZpZXdlcnMuc2xpY2UoKTtcbiAgICAgICAgICAgIHZhciBpbnRlcnZpZXdlcnMgPSAkc2NvcGUuaW50ZXJ2aWV3ZXJzO1xuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGludGVydmlld2Vycy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgdmFyIGludGVydmlld2VyID0gaW50ZXJ2aWV3ZXJzW2ldO1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBhZGRlZC5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgICAgIGlmKGludGVydmlld2VyLl9pZCA9PT0gYWRkZWRbal0uX2lkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmlld2VyLmFkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoKSB7XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gcmVkaXJlY3QoKSB7XG4gICAgICAgICAgICAvLyBoaWRlIHJvd1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgICRzY29wZS5yZW1vdmUgPSBmdW5jdGlvbihpZCl7XG4gICAgICAgIHZhciBpbnRlcnZpZXdlcnMgPSAkc2NvcGUuaW50ZXJ2aWV3ZXJzO1xuICAgICAgICBmb3IodmFyIGk9MDsgaSA8aW50ZXJ2aWV3ZXJzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIHZhciBpbnRlcnZpZXdlciA9IGludGVydmlld2Vyc1tpXTtcbiAgICAgICAgICAgIGlmKGludGVydmlld2VyLl9pZCA9PT0gaWQpe1xuICAgICAgICAgICAgICAgIGludGVydmlld2VyLmFkZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV2ZW50ID0gJHJvdXRlUGFyYW1zLl9pZDtcbiAgICAgICAgJGh0dHAucG9zdCgnYXBpL2V2ZW50L3JlbW92ZUludGVydmlld2VyP19pZD0nK2V2ZW50LCB7X2lkOiBpZH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICB9KVxuICAgIH1cbn1dKTsiLCJhcHAuY29udHJvbGxlcignYWRkU3R1ZGVudHMnLCBbJyRzY29wZScsICckaHR0cCcsICckcm91dGVQYXJhbXMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpe1xuICAgICRodHRwLmdldCgnL2FwaS9zdHVkZW50JykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAkc2NvcGUuc3R1ZGVudHMgPSByZXNwb25zZS5kYXRhO1xuICAgIH0pO1xuICAgICRodHRwLmdldCgnL2FwaS9ldmVudD9faWQ9Jyskcm91dGVQYXJhbXMuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgdmFyIGFkZGVkID0gcmVzcG9uc2UuZGF0YVswXS5zdHVkZW50cy5zbGljZSgpO1xuICAgICAgICB2YXIgc3R1ZGVudHMgPSAkc2NvcGUuc3R1ZGVudHM7XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBzdHVkZW50cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICB2YXIgc3R1ZGVudCA9IHN0dWRlbnRzW2ldO1xuICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IGFkZGVkLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICBpZihzdHVkZW50Ll9pZCA9PT0gYWRkZWRbal0uX2lkKXtcbiAgICAgICAgICAgICAgICAgICAgc3R1ZGVudC5hZGRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5hZGRlZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5zdHVkZW50cyk7XG5cbiAgICB9KTtcblxuICAgIHZhciBldmVudFBhcmFtID0gJHJvdXRlUGFyYW1zLl9pZDtcbiAgICAkc2NvcGUuZXZlbnRJZCA9IGV2ZW50UGFyYW07XG4gICAgY29uc29sZS5sb2coZXZlbnRQYXJhbSk7XG4gICAgY29uc29sZS5sb2coJHJvdXRlUGFyYW1zKTtcblxuICAgICRzY29wZS5hZGRTdHVkZW50ID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2V2ZW50L2FkZFN0dWRlbnQ/X2lkPScgKyBldmVudFBhcmFtLFxuICAgICAgICAgICAgZGF0YToge19pZDogaWR9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGFkZGVkID0gcmVzcG9uc2UuZGF0YS5zdHVkZW50cy5zbGljZSgpO1xuICAgICAgICAgICAgdmFyIHN0dWRlbnRzID0gJHNjb3BlLnN0dWRlbnRzO1xuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHN0dWRlbnRzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICB2YXIgc3R1ZGVudCA9IHN0dWRlbnRzW2ldO1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBhZGRlZC5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgICAgIGlmKHN0dWRlbnQuX2lkID09PSBhZGRlZFtqXS5faWQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudC5hZGRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKCkge1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHJlZGlyZWN0KCkge1xuICAgICAgICAgICAgLy8gaGlkZSByb3dcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAkc2NvcGUucmVtb3ZlID0gZnVuY3Rpb24oaWQpe1xuICAgICAgICB2YXIgc3R1ZGVudHMgPSAkc2NvcGUuc3R1ZGVudHM7XG4gICAgICAgIGZvcih2YXIgaT0wOyBpIDxzdHVkZW50cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICB2YXIgc3R1ZGVudCA9IHN0dWRlbnRzW2ldO1xuICAgICAgICAgICAgaWYoc3R1ZGVudC5faWQgPT09IGlkKXtcbiAgICAgICAgICAgICAgICBzdHVkZW50LmFkZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV2ZW50ID0gJHJvdXRlUGFyYW1zLl9pZDtcbiAgICAgICAgJGh0dHAucG9zdCgnYXBpL2V2ZW50L3JlbW92ZVN0dWRlbnQ/X2lkPScrZXZlbnQsIHtfaWQ6IGlkfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgIH0pXG4gICAgfVxufV0pOyIsIlxuLypcbiBWaWV3IGV2ZW50cyBjb250cm9sbGVyXG4gKi9cbmFwcC5jb250cm9sbGVyKCd2aWV3RXZlbnRDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGZpbHRlcicsICckcm91dGVQYXJhbXMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkZmlsdGVyLCAkcm91dGVQYXJhbXMpIHtcblxuICAgIHZhciBldmVudFBhcmFtID0gJHJvdXRlUGFyYW1zLl9pZDtcbiAgICAkc2NvcGUuZXZlbnRJZCA9IGV2ZW50UGFyYW07XG5cbiAgICAkaHR0cC5nZXQoJy9hcGkvZXZlbnQ/X2lkPScgKyBldmVudFBhcmFtKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2UpIHtcblxuICAgICAgICAkc2NvcGUuZXZlbnRUaXRsZSA9IHJlc3BvbnNlLmRhdGFbMF0uY29ob3J0ICsgJyAnICsgcmVzcG9uc2UuZGF0YVswXS50eXBlO1xuICAgICAgICAkc2NvcGUuZXZlbnREYXRlID0gJGZpbHRlcignZGF0ZScpKG5ldyBEYXRlKHJlc3BvbnNlLmRhdGFbMF0uZGF0ZSksICdNTS9kZC95eScpO1xuICAgICAgICAkc2NvcGUuZXZlbnRTdGltZSA9IHJlc3BvbnNlLmRhdGFbMF0uc3RhcnRUaW1lO1xuICAgICAgICAkc2NvcGUuZXZlbnRFdGltZSA9IHJlc3BvbnNlLmRhdGFbMF0uZW5kVGltZTtcbiAgICAgICAgJHNjb3BlLmV2ZW50RHVyID0gcmVzcG9uc2UuZGF0YVswXS5pbnRlcnZpZXdEdXJhdGlvbjtcbiAgICAgICAgJHNjb3BlLmV2ZW50TG9jID0gdHlwZW9mIHJlc3BvbnNlLmRhdGFbMF0ubG9jYXRpb24gIT0gJ3VuZGVmaW5lZCcgPyByZXNwb25zZS5kYXRhWzBdLmxvY2F0aW9uIDogJ05BJztcbiAgICAgICAgJHNjb3BlLmV2ZW50T3JnID0gdHlwZW9mIHJlc3BvbnNlLmRhdGFbMF0ub3JnYW5pemVyICE9ICd1bmRlZmluZWQnID8gcmVzcG9uc2UuZGF0YVswXS5vcmdhbml6ZXIgOiAnTkEnO1xuXG4gICAgfSwgZnVuY3Rpb24gZXJyb3IoKSB7fSk7XG5cbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
