var app = angular.module('app', ['ngMaterial', 'ngRoute', 'ui.grid', 'ui.grid.edit', 'ui.grid.rowEdit', 'ui.grid.exporter']);

// Angular routing
app.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider){
    $locationProvider.html5Mode({
        enabled: true
    });
    $routeProvider.
        when('/home', {
            templateUrl: 'views/partials/home.html'
        }).
        when('/', {
            templateUrl: 'views/partials/login/login.html'
        }).
        when('/forgot', {
            templateUrl: 'views/partials/forgot/forgot.html'
        }).
        when('/events', {
            templateUrl: 'views/partials/events/events.html'
        }).
        when('/students', {
            templateUrl: 'views/partials/students/students.html'
        }).
        when('/interviewers', {
            templateUrl: 'views/partials/interviewers/interviewers.html'
        }).
        when('/archived-events', {
            templateUrl: 'views/partials/archived-events/archived-events.html'
        }).
        when('/profile', {
            templateUrl: 'views/partials/profile/profile.html'
        }).
        when('/logout', {
            templateUrl: 'views/partials/logout/logout.html'
        }).
        when('/new-event', {
            templateUrl: 'views/partials/new-event/new-event.html'
        }).
        when('/event', {
            templateUrl: 'views/partials/event/event.html'
        }).
        when('/reset/:token', {
            templateUrl: 'views/partials/reset/reset.html',
            controller: 'reset'
        }).
        otherwise({
            redirectTo: '/views/partials/login.html'
    })
}]);

// Toolbar controller
app.controller('toolbar', ['$rootScope','$scope', '$window', function($rootScope, $scope, $window){
    $scope.paths = true;
    $rootScope.$on('logged In', function(){
        if($window.sessionStorage.token == undefined){
            $scope.paths = true;
        }else{
            $scope.paths = false;
            $scope.user = {
                username: $window.sessionStorage.username.replace(/^"(.*)"$/, '$1')
            };
        }
    })
}]);

// Directive to check the passwords are the same
app.directive('verifySame', function(){
       return {
           require: "ngModel",
           scope: {
               otherModelValue: "=compareTo"
           },
           link: function(scope, element, attributes, ngModel) {
               ngModel.$validators.compareTo = function(modelValue) {
                   return modelValue == scope.otherModelValue;
               };
               scope.$watch("password", function() {
                   ngModel.$validate();
               });
           }
       };
});

// Archived events controller

// Generate event controller
app.controller('generateCtrl', ['$scope', '$http', function($scope, $http) {

    // time experiments
    var startTime = moment('1:00 PM', 'h:mm A').format('HH:mm');
    var endTime = moment('4:00 PM', 'h:mm A').format('HH:mm');
    var eventLength = moment(endTime, 'HH:mm').diff(moment(startTime, 'HH:mm'), 'minutes');
    var slotLength = moment.duration((eventLength / 9), 'minutes').asMinutes();
    console.log(moment(startTime, 'HH:mm').add((slotLength * 8), 'minutes').format('h:mm A'));

    // Initialize UI Grid variables
    var gridCols = [];
    var gridData = [];

    // UI Grid options
    $scope.gridOptions = {
        enableSorting: false,
        enableGridMenu: true,
        enableFiltering: false,
        onRegisterApi: function (gridApi) {
            $scope.gridApi = gridApi;
        }
    };

    // "Generate" button click function
    $scope.generate = function () {

        // request matches from server given event settings
        $http({
            method: 'GET',
            url: 'http://localhost:3000/test'
        }).then(function successCallback(response) {

            // empty the UI Grid variables in case there is data
            $scope.gridOptions.columnDefs = [];
            $scope.gridOptions.data = [];
            gridCols = [];
            gridData = [];

            // console log API response for debugging
            console.log(response);

            // iterate over the interviewer array within the response
            // create various arrays and objects to meet UI Grid data requirements
            response.data.interviewer.forEach(function(item, pos) {

                // push the company and interviewer name into the column names array
                // this will be the column header for a particular interviewer
                gridCols.push({name: item.company + ' / ' + item.fName, field: item.company + '_' + item.name, width:150, displayName: item.company + ' / ' + item.fName});

                // set the scheduled object to a variable
                // this object contains the entire schedule for an interviewer
                var sched = item.scheduled;

                // initiate an empty students array
                // this will be used to store the formatted schedule for each company
                var students = [];

                // iterate over the scheduled object using the getOwnPropertyNames method
                Object.getOwnPropertyNames(sched).forEach(function (elem, index, array) {
                    // create an array of objects that contains each scheduled item
                    // this array will contain the formatted schedule for an interviewer
                    titleObj = {};
                    titleObj[item.company + '_' + item.fname] = sched[elem];
                    students.push(titleObj);
            });

            // push the updated schedule array into the master gridData array
            gridData.push(students);
            });

            // gridData is still not correctly formatted
            // each item represents an interviewer column
            // when in fact, UI Grid requires each item in the array to be a row of data
            // Underscore unzip function performs necessary matrix transformation
            gridData = _.unzip(gridData);

            // initiate empty array to store each row as an object of objects
            var gridArr = [];

            // iterate over unzipped gridData
            gridData.forEach(function (item, pos) {

                // initiate empty object for storing individual schedule items
                var rowObj = {};

                // iterate over the schedule row
                // each item in the row array represents a single cell in the grid
                item.forEach(function (elem, index) {
                    // use Underscore extend method to "push" each item into row object
                    _.extend(rowObj, elem);
                });

                // push the row object into the previously initiated grid array
                gridArr.push(rowObj);
            });

            // initiate an empty object for storing the entire schedule
            gridObj = {};

            // create time slots column
            var timeSlots = [];
            var slotsSize = gridArr.length;
            while(slotsSize--) {
                timeSlots.push({time: 'Slot ' + ((gridArr.length) - slotsSize)});
            }

            console.log(timeSlots);

            // using Underscore extend again, "push" the array of objects into the master object
            _.extend(gridObj, gridArr);

            // update the gridData variable
            gridData = gridArr;
        }).then(function() {

            // after capturing and formatting the data, update UI Grid options
            $scope.gridOptions.columnDefs = gridCols;
            $scope.gridOptions.data = gridData;
        })
    };
}]);

// Events controller
app.controller('eventsCtrl', function($scope) {
        this.tiles = buildGridModel({
            title: "Event Title",
            background: ""
        });
        function buildGridModel(tileTmpl){
            var it, results = [ ];
                it = angular.extend({},tileTmpl);
                it.title = it.title;
                it.span  = { row : 1, col : 1 };
                it.background = "gray";
                it.span.row = it.span.col = 1;

                results.push(it);

            return results;
        }
    });


// Forgot controller
app.controller('sendEmail', ['$scope', '$http', '$location', function($scope, $http, $location){
    $scope.send = function(email) {
        $http.post('/forgot', {email: email}).then(function (response) {
            if (response.status == 200) {
                $location.path('/')
            }
        })
    }
}]);

// Interviewers controller


// Login controller
app.controller('login', ['$rootScope','$scope', '$http', '$location', '$mdToast', function($rootScope, $scope, $http, $location, $mdToast){
    $scope.submit = function(username, password){
        $http.post('/authenticate', {username: username, password: password}).then(function(response){
                if(response.data.token){
                    sessionStorage.username = angular.toJson(response.data.user.username);
                    sessionStorage.email = angular.toJson(response.data.user.email);
                    sessionStorage.token = angular.toJson(response.data.token);
                    $location.path('/events');
                    $rootScope.$broadcast('logged In')
                }else{
                    $mdToast.showSimple(response.data.error)
                }

            }

        )
    }
}]);

// Logout controller
app.controller('logout', ['$rootScope', '$scope','$location', '$interval', function($rootScope, $scope, $location, $interval){
    $scope.logout = function(){
        $location.path('/logout');
        sessionStorage.clear();
        $rootScope.$broadcast('logged In');
        $interval(function() {
            $location.path('/')
        }, 3000, 1)
    };
}]);

// New event controller
app.controller('newEventCtrl', ['$scope', '$http', function($scope, $http) {

}]);

// Profile controller
app.controller('profile', ['$scope', '$http', '$window', '$location', function($scope, $http, $window, $location){
    $scope.username = $window.sessionStorage.username.replace(/^"(.*)"$/, '$1');
    $scope.email = $window.sessionStorage.email.replace(/^"(.*)"$/, '$1');
    $scope.save = function(password){
        var username = $scope.username;
        var email = $scope.email;
        $http.post('/change', {username: username, email: email, password: password}).then(function(response){
            if(response.status === 200){
                $location.path('/events')
            }
        });
    }
}]);

// Reset controller
app.controller('reset',['$scope', '$http', '$routeParams', '$location', function($scope, $http, $routeParams, $location){
    $scope.changePass = function(password, confirm){
        console.log(password);
        var token = $routeParams.token;
        if(password === confirm){
            $http.post('/reset', {password: password, token: token}).then(function(response){
                console.log(response);
                if(response.status === 200){
                    $location.path('/');
                }
            })
        }
    }
}]);

// Students controller


// Interviewer dialog controller
app.controller('interviewer', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openInterviewer = function(ev){
        $mdDialog.show({
            controller: addInterviewer,
            templateUrl: 'views/partials/dialogs/interviewer/interviewer.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addInterviewer($scope){
        $scope.close = function() {
            $mdDialog.hide();
            $scope.cohorts = [
                {name: 'Delta'},
                {name: 'gamma'},
                {name: 'Epsilon'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        }
    }
}]);

// Student dialog controller
app.controller('student', ['$scope', '$mdDialog', function($scope,$mdDialog){
    $scope.openStudents = function(ev){
        $mdDialog.show({
            controller: addStudent,
            templateUrl: 'views/partials/dialogs/student/student.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addStudent($scope) {
        $scope.close = function () {
            $mdDialog.hide();
            $scope.companies = [
                {name: 'Prime'},
                {name: 'Nerdery'},
                {name: 'Digital People'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        }
    }

}]);

// Register dialog controller
app.controller('registerOpen', ['$scope', '$mdDialog', '$http', function($scope, $mdDialog){
    $scope.openRegister = function(ev){
        $mdDialog.show({
            controller: register,
            templateUrl: 'views/partials/dialogs/register/register.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function register($scope, $http, $mdDialog) {
        $scope.register = function(username, email, password){
            $http.post('/api/users', {
                username: username,
                email: email,
                password: password
            }).then(function(response){
                console.log(response);
                if(response == 200) {
                    $mdDialog.hide()
                }
            });
        };
        $scope.close = function(){
            $mdDialog.hide();
        };
    }
}]);

// Student dialog controller
app.controller('uploads', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openUploads = function(ev){
        $mdDialog.show({
            controller: uploadFile,
            templateUrl: 'views/partials/dialogs/upload/upload.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function uploadFile($scope, $mdDialog){
        $scope.close = function() {
            $mdDialog.hide();
        }
    }
}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFyY2hpdmVkLWV2ZW50cy9hcmNoaXZlZC1ldmVudHMuY29udHJvbGxlci5qcyIsImV2ZW50L2dlbmVyYXRlRXZlbnQuY29udHJvbGxlci5qcyIsImV2ZW50cy9ldmVudHMuY29udHJvbGxlci5qcyIsImZvcmdvdC9mb3Jnb3QuY29udHJvbGxlci5qcyIsImludGVydmlld2Vycy9pbnRlcnZpZXdlcnMuY29udHJvbGxlci5qcyIsImxvZ2luL2xvZ2luLmNvbnRyb2xsZXIuanMiLCJsb2dvdXQvbG9nb3V0LmNvbnRyb2xsZXIuanMiLCJuZXctZXZlbnQvbmV3LWV2ZW50LmNvbnRyb2xsZXIuanMiLCJwcm9maWxlL3Byb2ZpbGUuY29udHJvbGxlci5qcyIsInJlc2V0L3Jlc2V0LmNvbnRyb2xsZXIuanMiLCJzdHVkZW50cy9zdHVkZW50cy5jb250cm9sbGVyLmpzIiwiZGlhbG9ncy9pbnRlcnZpZXdlci9pbnRlcnZpZXdlci5jb250cm9sbGVyLmpzIiwiZGlhbG9ncy9zdHVkZW50L3N0dWRlbnQuY29udHJvbGxlci5qcyIsImRpYWxvZ3MvcmVnaXN0ZXIvcmVnaXN0ZXIuY29udHJvbGxlci5qcyIsImRpYWxvZ3MvdXBsb2FkL3VwbG9hZC5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakZBO0FBQ0E7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICd1aS5ncmlkJywgJ3VpLmdyaWQuZWRpdCcsICd1aS5ncmlkLnJvd0VkaXQnLCAndWkuZ3JpZC5leHBvcnRlciddKTtcblxuLy8gQW5ndWxhciByb3V0aW5nXG5hcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpe1xuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh7XG4gICAgICAgIGVuYWJsZWQ6IHRydWVcbiAgICB9KTtcbiAgICAkcm91dGVQcm92aWRlci5cbiAgICAgICAgd2hlbignL2hvbWUnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2hvbWUuaHRtbCdcbiAgICAgICAgfSkuXG4gICAgICAgIHdoZW4oJy8nLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2xvZ2luL2xvZ2luLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvZm9yZ290Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9mb3Jnb3QvZm9yZ290Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvZXZlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9ldmVudHMvZXZlbnRzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvc3R1ZGVudHMnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL3N0dWRlbnRzL3N0dWRlbnRzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvaW50ZXJ2aWV3ZXJzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9pbnRlcnZpZXdlcnMvaW50ZXJ2aWV3ZXJzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvYXJjaGl2ZWQtZXZlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9hcmNoaXZlZC1ldmVudHMvYXJjaGl2ZWQtZXZlbnRzLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvcHJvZmlsZScsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvcHJvZmlsZS9wcm9maWxlLmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvbG9nb3V0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9sb2dvdXQvbG9nb3V0Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvbmV3LWV2ZW50Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9uZXctZXZlbnQvbmV3LWV2ZW50Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvZXZlbnQnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2V2ZW50L2V2ZW50Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvcmVzZXQvOnRva2VuJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9yZXNldC9yZXNldC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZXNldCdcbiAgICAgICAgfSkuXG4gICAgICAgIG90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLmh0bWwnXG4gICAgfSlcbn1dKTtcblxuLy8gVG9vbGJhciBjb250cm9sbGVyXG5hcHAuY29udHJvbGxlcigndG9vbGJhcicsIFsnJHJvb3RTY29wZScsJyRzY29wZScsICckd2luZG93JywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkd2luZG93KXtcbiAgICAkc2NvcGUucGF0aHMgPSB0cnVlO1xuICAgICRyb290U2NvcGUuJG9uKCdsb2dnZWQgSW4nLCBmdW5jdGlvbigpe1xuICAgICAgICBpZigkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuID09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAkc2NvcGUucGF0aHMgPSB0cnVlO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICRzY29wZS5wYXRocyA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudXNlcm5hbWUucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSlcbn1dKTtcblxuLy8gRGlyZWN0aXZlIHRvIGNoZWNrIHRoZSBwYXNzd29yZHMgYXJlIHRoZSBzYW1lXG5hcHAuZGlyZWN0aXZlKCd2ZXJpZnlTYW1lJywgZnVuY3Rpb24oKXtcbiAgICAgICByZXR1cm4ge1xuICAgICAgICAgICByZXF1aXJlOiBcIm5nTW9kZWxcIixcbiAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgIG90aGVyTW9kZWxWYWx1ZTogXCI9Y29tcGFyZVRvXCJcbiAgICAgICAgICAgfSxcbiAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuY29tcGFyZVRvID0gZnVuY3Rpb24obW9kZWxWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlID09IHNjb3BlLm90aGVyTW9kZWxWYWx1ZTtcbiAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJwYXNzd29yZFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgIH1cbiAgICAgICB9O1xufSk7IiwiXG4vLyBBcmNoaXZlZCBldmVudHMgY29udHJvbGxlciIsIlxuLy8gR2VuZXJhdGUgZXZlbnQgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ2dlbmVyYXRlQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCkge1xuXG4gICAgLy8gdGltZSBleHBlcmltZW50c1xuICAgIHZhciBzdGFydFRpbWUgPSBtb21lbnQoJzE6MDAgUE0nLCAnaDptbSBBJykuZm9ybWF0KCdISDptbScpO1xuICAgIHZhciBlbmRUaW1lID0gbW9tZW50KCc0OjAwIFBNJywgJ2g6bW0gQScpLmZvcm1hdCgnSEg6bW0nKTtcbiAgICB2YXIgZXZlbnRMZW5ndGggPSBtb21lbnQoZW5kVGltZSwgJ0hIOm1tJykuZGlmZihtb21lbnQoc3RhcnRUaW1lLCAnSEg6bW0nKSwgJ21pbnV0ZXMnKTtcbiAgICB2YXIgc2xvdExlbmd0aCA9IG1vbWVudC5kdXJhdGlvbigoZXZlbnRMZW5ndGggLyA5KSwgJ21pbnV0ZXMnKS5hc01pbnV0ZXMoKTtcbiAgICBjb25zb2xlLmxvZyhtb21lbnQoc3RhcnRUaW1lLCAnSEg6bW0nKS5hZGQoKHNsb3RMZW5ndGggKiA4KSwgJ21pbnV0ZXMnKS5mb3JtYXQoJ2g6bW0gQScpKTtcblxuICAgIC8vIEluaXRpYWxpemUgVUkgR3JpZCB2YXJpYWJsZXNcbiAgICB2YXIgZ3JpZENvbHMgPSBbXTtcbiAgICB2YXIgZ3JpZERhdGEgPSBbXTtcblxuICAgIC8vIFVJIEdyaWQgb3B0aW9uc1xuICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IHtcbiAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgIGVuYWJsZUdyaWRNZW51OiB0cnVlLFxuICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICBvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIFwiR2VuZXJhdGVcIiBidXR0b24gY2xpY2sgZnVuY3Rpb25cbiAgICAkc2NvcGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLy8gcmVxdWVzdCBtYXRjaGVzIGZyb20gc2VydmVyIGdpdmVuIGV2ZW50IHNldHRpbmdzXG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvdGVzdCdcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgLy8gZW1wdHkgdGhlIFVJIEdyaWQgdmFyaWFibGVzIGluIGNhc2UgdGhlcmUgaXMgZGF0YVxuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgICAgICBncmlkQ29scyA9IFtdO1xuICAgICAgICAgICAgZ3JpZERhdGEgPSBbXTtcblxuICAgICAgICAgICAgLy8gY29uc29sZSBsb2cgQVBJIHJlc3BvbnNlIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBpbnRlcnZpZXdlciBhcnJheSB3aXRoaW4gdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICAvLyBjcmVhdGUgdmFyaW91cyBhcnJheXMgYW5kIG9iamVjdHMgdG8gbWVldCBVSSBHcmlkIGRhdGEgcmVxdWlyZW1lbnRzXG4gICAgICAgICAgICByZXNwb25zZS5kYXRhLmludGVydmlld2VyLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgcG9zKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBwdXNoIHRoZSBjb21wYW55IGFuZCBpbnRlcnZpZXdlciBuYW1lIGludG8gdGhlIGNvbHVtbiBuYW1lcyBhcnJheVxuICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBiZSB0aGUgY29sdW1uIGhlYWRlciBmb3IgYSBwYXJ0aWN1bGFyIGludGVydmlld2VyXG4gICAgICAgICAgICAgICAgZ3JpZENvbHMucHVzaCh7bmFtZTogaXRlbS5jb21wYW55ICsgJyAvICcgKyBpdGVtLmZOYW1lLCBmaWVsZDogaXRlbS5jb21wYW55ICsgJ18nICsgaXRlbS5uYW1lLCB3aWR0aDoxNTAsIGRpc3BsYXlOYW1lOiBpdGVtLmNvbXBhbnkgKyAnIC8gJyArIGl0ZW0uZk5hbWV9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgc2NoZWR1bGVkIG9iamVjdCB0byBhIHZhcmlhYmxlXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBvYmplY3QgY29udGFpbnMgdGhlIGVudGlyZSBzY2hlZHVsZSBmb3IgYW4gaW50ZXJ2aWV3ZXJcbiAgICAgICAgICAgICAgICB2YXIgc2NoZWQgPSBpdGVtLnNjaGVkdWxlZDtcblxuICAgICAgICAgICAgICAgIC8vIGluaXRpYXRlIGFuIGVtcHR5IHN0dWRlbnRzIGFycmF5XG4gICAgICAgICAgICAgICAgLy8gdGhpcyB3aWxsIGJlIHVzZWQgdG8gc3RvcmUgdGhlIGZvcm1hdHRlZCBzY2hlZHVsZSBmb3IgZWFjaCBjb21wYW55XG4gICAgICAgICAgICAgICAgdmFyIHN0dWRlbnRzID0gW107XG5cbiAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIHNjaGVkdWxlZCBvYmplY3QgdXNpbmcgdGhlIGdldE93blByb3BlcnR5TmFtZXMgbWV0aG9kXG4gICAgICAgICAgICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoc2NoZWQpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGluZGV4LCBhcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB0aGF0IGNvbnRhaW5zIGVhY2ggc2NoZWR1bGVkIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBhcnJheSB3aWxsIGNvbnRhaW4gdGhlIGZvcm1hdHRlZCBzY2hlZHVsZSBmb3IgYW4gaW50ZXJ2aWV3ZXJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGVPYmogPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGVPYmpbaXRlbS5jb21wYW55ICsgJ18nICsgaXRlbS5mbmFtZV0gPSBzY2hlZFtlbGVtXTtcbiAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHMucHVzaCh0aXRsZU9iaik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gcHVzaCB0aGUgdXBkYXRlZCBzY2hlZHVsZSBhcnJheSBpbnRvIHRoZSBtYXN0ZXIgZ3JpZERhdGEgYXJyYXlcbiAgICAgICAgICAgIGdyaWREYXRhLnB1c2goc3R1ZGVudHMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGdyaWREYXRhIGlzIHN0aWxsIG5vdCBjb3JyZWN0bHkgZm9ybWF0dGVkXG4gICAgICAgICAgICAvLyBlYWNoIGl0ZW0gcmVwcmVzZW50cyBhbiBpbnRlcnZpZXdlciBjb2x1bW5cbiAgICAgICAgICAgIC8vIHdoZW4gaW4gZmFjdCwgVUkgR3JpZCByZXF1aXJlcyBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5IHRvIGJlIGEgcm93IG9mIGRhdGFcbiAgICAgICAgICAgIC8vIFVuZGVyc2NvcmUgdW56aXAgZnVuY3Rpb24gcGVyZm9ybXMgbmVjZXNzYXJ5IG1hdHJpeCB0cmFuc2Zvcm1hdGlvblxuICAgICAgICAgICAgZ3JpZERhdGEgPSBfLnVuemlwKGdyaWREYXRhKTtcblxuICAgICAgICAgICAgLy8gaW5pdGlhdGUgZW1wdHkgYXJyYXkgdG8gc3RvcmUgZWFjaCByb3cgYXMgYW4gb2JqZWN0IG9mIG9iamVjdHNcbiAgICAgICAgICAgIHZhciBncmlkQXJyID0gW107XG5cbiAgICAgICAgICAgIC8vIGl0ZXJhdGUgb3ZlciB1bnppcHBlZCBncmlkRGF0YVxuICAgICAgICAgICAgZ3JpZERhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgcG9zKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBpbml0aWF0ZSBlbXB0eSBvYmplY3QgZm9yIHN0b3JpbmcgaW5kaXZpZHVhbCBzY2hlZHVsZSBpdGVtc1xuICAgICAgICAgICAgICAgIHZhciByb3dPYmogPSB7fTtcblxuICAgICAgICAgICAgICAgIC8vIGl0ZXJhdGUgb3ZlciB0aGUgc2NoZWR1bGUgcm93XG4gICAgICAgICAgICAgICAgLy8gZWFjaCBpdGVtIGluIHRoZSByb3cgYXJyYXkgcmVwcmVzZW50cyBhIHNpbmdsZSBjZWxsIGluIHRoZSBncmlkXG4gICAgICAgICAgICAgICAgaXRlbS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAvLyB1c2UgVW5kZXJzY29yZSBleHRlbmQgbWV0aG9kIHRvIFwicHVzaFwiIGVhY2ggaXRlbSBpbnRvIHJvdyBvYmplY3RcbiAgICAgICAgICAgICAgICAgICAgXy5leHRlbmQocm93T2JqLCBlbGVtKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHB1c2ggdGhlIHJvdyBvYmplY3QgaW50byB0aGUgcHJldmlvdXNseSBpbml0aWF0ZWQgZ3JpZCBhcnJheVxuICAgICAgICAgICAgICAgIGdyaWRBcnIucHVzaChyb3dPYmopO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGluaXRpYXRlIGFuIGVtcHR5IG9iamVjdCBmb3Igc3RvcmluZyB0aGUgZW50aXJlIHNjaGVkdWxlXG4gICAgICAgICAgICBncmlkT2JqID0ge307XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSB0aW1lIHNsb3RzIGNvbHVtblxuICAgICAgICAgICAgdmFyIHRpbWVTbG90cyA9IFtdO1xuICAgICAgICAgICAgdmFyIHNsb3RzU2l6ZSA9IGdyaWRBcnIubGVuZ3RoO1xuICAgICAgICAgICAgd2hpbGUoc2xvdHNTaXplLS0pIHtcbiAgICAgICAgICAgICAgICB0aW1lU2xvdHMucHVzaCh7dGltZTogJ1Nsb3QgJyArICgoZ3JpZEFyci5sZW5ndGgpIC0gc2xvdHNTaXplKX0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aW1lU2xvdHMpO1xuXG4gICAgICAgICAgICAvLyB1c2luZyBVbmRlcnNjb3JlIGV4dGVuZCBhZ2FpbiwgXCJwdXNoXCIgdGhlIGFycmF5IG9mIG9iamVjdHMgaW50byB0aGUgbWFzdGVyIG9iamVjdFxuICAgICAgICAgICAgXy5leHRlbmQoZ3JpZE9iaiwgZ3JpZEFycik7XG5cbiAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgZ3JpZERhdGEgdmFyaWFibGVcbiAgICAgICAgICAgIGdyaWREYXRhID0gZ3JpZEFycjtcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgLy8gYWZ0ZXIgY2FwdHVyaW5nIGFuZCBmb3JtYXR0aW5nIHRoZSBkYXRhLCB1cGRhdGUgVUkgR3JpZCBvcHRpb25zXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRDb2xzO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSBncmlkRGF0YTtcbiAgICAgICAgfSlcbiAgICB9O1xufV0pOyIsIlxuLy8gRXZlbnRzIGNvbnRyb2xsZXJcbmFwcC5jb250cm9sbGVyKCdldmVudHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7XG4gICAgICAgIHRoaXMudGlsZXMgPSBidWlsZEdyaWRNb2RlbCh7XG4gICAgICAgICAgICB0aXRsZTogXCJFdmVudCBUaXRsZVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZDogXCJcIlxuICAgICAgICB9KTtcbiAgICAgICAgZnVuY3Rpb24gYnVpbGRHcmlkTW9kZWwodGlsZVRtcGwpe1xuICAgICAgICAgICAgdmFyIGl0LCByZXN1bHRzID0gWyBdO1xuICAgICAgICAgICAgICAgIGl0ID0gYW5ndWxhci5leHRlbmQoe30sdGlsZVRtcGwpO1xuICAgICAgICAgICAgICAgIGl0LnRpdGxlID0gaXQudGl0bGU7XG4gICAgICAgICAgICAgICAgaXQuc3BhbiAgPSB7IHJvdyA6IDEsIGNvbCA6IDEgfTtcbiAgICAgICAgICAgICAgICBpdC5iYWNrZ3JvdW5kID0gXCJncmF5XCI7XG4gICAgICAgICAgICAgICAgaXQuc3Bhbi5yb3cgPSBpdC5zcGFuLmNvbCA9IDE7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goaXQpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiXG4vLyBGb3Jnb3QgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ3NlbmRFbWFpbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnNlbmQgPSBmdW5jdGlvbihlbWFpbCkge1xuICAgICAgICAkaHR0cC5wb3N0KCcvZm9yZ290Jywge2VtYWlsOiBlbWFpbH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG59XSk7IiwiXG4vLyBJbnRlcnZpZXdlcnMgY29udHJvbGxlclxuIiwiXG4vLyBMb2dpbiBjb250cm9sbGVyXG5hcHAuY29udHJvbGxlcignbG9naW4nLCBbJyRyb290U2NvcGUnLCckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJyRtZFRvYXN0JywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCAkbWRUb2FzdCl7XG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCl7XG4gICAgICAgICRodHRwLnBvc3QoJy9hdXRoZW50aWNhdGUnLCB7dXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmR9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLnRva2VuKXtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UudXNlcm5hbWUgPSBhbmd1bGFyLnRvSnNvbihyZXNwb25zZS5kYXRhLnVzZXIudXNlcm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5lbWFpbCA9IGFuZ3VsYXIudG9Kc29uKHJlc3BvbnNlLmRhdGEudXNlci5lbWFpbCk7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnRva2VuID0gYW5ndWxhci50b0pzb24ocmVzcG9uc2UuZGF0YS50b2tlbik7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRzJyk7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2VkIEluJylcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgJG1kVG9hc3Quc2hvd1NpbXBsZShyZXNwb25zZS5kYXRhLmVycm9yKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIClcbiAgICB9XG59XSk7IiwiXG4vLyBMb2dvdXQgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ2xvZ291dCcsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCckbG9jYXRpb24nLCAnJGludGVydmFsJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkbG9jYXRpb24sICRpbnRlcnZhbCl7XG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9nb3V0Jyk7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKCk7XG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2VkIEluJyk7XG4gICAgICAgICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJylcbiAgICAgICAgfSwgMzAwMCwgMSlcbiAgICB9O1xufV0pOyIsIlxuLy8gTmV3IGV2ZW50IGNvbnRyb2xsZXJcbmFwcC5jb250cm9sbGVyKCduZXdFdmVudEN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcblxufV0pOyIsIlxuLy8gUHJvZmlsZSBjb250cm9sbGVyXG5hcHAuY29udHJvbGxlcigncHJvZmlsZScsIFsnJHNjb3BlJywgJyRodHRwJywgJyR3aW5kb3cnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHdpbmRvdywgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUudXNlcm5hbWUgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlLnVzZXJuYW1lLnJlcGxhY2UoL15cIiguKilcIiQvLCAnJDEnKTtcbiAgICAkc2NvcGUuZW1haWwgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlLmVtYWlsLnJlcGxhY2UoL15cIiguKilcIiQvLCAnJDEnKTtcbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKHBhc3N3b3JkKXtcbiAgICAgICAgdmFyIHVzZXJuYW1lID0gJHNjb3BlLnVzZXJuYW1lO1xuICAgICAgICB2YXIgZW1haWwgPSAkc2NvcGUuZW1haWw7XG4gICAgICAgICRodHRwLnBvc3QoJy9jaGFuZ2UnLCB7dXNlcm5hbWU6IHVzZXJuYW1lLCBlbWFpbDogZW1haWwsIHBhc3N3b3JkOiBwYXNzd29yZH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApe1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufV0pOyIsIlxuLy8gUmVzZXQgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ3Jlc2V0JyxbJyRzY29wZScsICckaHR0cCcsICckcm91dGVQYXJhbXMnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS5jaGFuZ2VQYXNzID0gZnVuY3Rpb24ocGFzc3dvcmQsIGNvbmZpcm0pe1xuICAgICAgICBjb25zb2xlLmxvZyhwYXNzd29yZCk7XG4gICAgICAgIHZhciB0b2tlbiA9ICRyb3V0ZVBhcmFtcy50b2tlbjtcbiAgICAgICAgaWYocGFzc3dvcmQgPT09IGNvbmZpcm0pe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3Jlc2V0Jywge3Bhc3N3b3JkOiBwYXNzd29yZCwgdG9rZW46IHRva2VufSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxufV0pOyIsIlxuLy8gU3R1ZGVudHMgY29udHJvbGxlclxuIiwiXG4vLyBJbnRlcnZpZXdlciBkaWFsb2cgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ2ludGVydmlld2VyJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuSW50ZXJ2aWV3ZXIgPSBmdW5jdGlvbihldil7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGFkZEludGVydmlld2VyLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL2ludGVydmlld2VyL2ludGVydmlld2VyLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiBhZGRJbnRlcnZpZXdlcigkc2NvcGUpe1xuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuY29ob3J0cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ0RlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdnYW1tYSd9LFxuICAgICAgICAgICAgICAgIHtuYW1lOiAnRXBzaWxvbid9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgJHNjb3BlLmV2ZW50cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIERlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdjYXJlZXIgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIEVwc2lsb24nfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH1cbn1dKTsiLCJcbi8vIFN0dWRlbnQgZGlhbG9nIGNvbnRyb2xsZXJcbmFwcC5jb250cm9sbGVyKCdzdHVkZW50JywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCRtZERpYWxvZyl7XG4gICAgJHNjb3BlLm9wZW5TdHVkZW50cyA9IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgY29udHJvbGxlcjogYWRkU3R1ZGVudCxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy9zdHVkZW50L3N0dWRlbnQuaHRtbCcsXG4gICAgICAgICAgICBwYXJlbnQ6IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5ib2R5KSxcbiAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldixcbiAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWVcbiAgICAgICAgfSlcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGFkZFN0dWRlbnQoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuY29tcGFuaWVzID0gW1xuICAgICAgICAgICAgICAgIHtuYW1lOiAnUHJpbWUnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ05lcmRlcnknfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ0RpZ2l0YWwgUGVvcGxlJ31cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICAkc2NvcGUuZXZlbnRzID0gW1xuICAgICAgICAgICAgICAgIHtuYW1lOiAnbW9ja3MgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ2NhcmVlciBEZWx0YSd9LFxuICAgICAgICAgICAgICAgIHtuYW1lOiAnbW9ja3MgRXBzaWxvbid9XG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgfVxuXG59XSk7IiwiXG4vLyBSZWdpc3RlciBkaWFsb2cgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyT3BlbicsIFsnJHNjb3BlJywgJyRtZERpYWxvZycsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJG1kRGlhbG9nKXtcbiAgICAkc2NvcGUub3BlblJlZ2lzdGVyID0gZnVuY3Rpb24oZXYpe1xuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICBjb250cm9sbGVyOiByZWdpc3RlcixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy9yZWdpc3Rlci9yZWdpc3Rlci5odG1sJyxcbiAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxuICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZVxuICAgICAgICB9KVxuICAgIH07XG4gICAgZnVuY3Rpb24gcmVnaXN0ZXIoJHNjb3BlLCAkaHR0cCwgJG1kRGlhbG9nKSB7XG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQpe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9O1xuICAgIH1cbn1dKTsiLCJcbi8vIFN0dWRlbnQgZGlhbG9nIGNvbnRyb2xsZXJcbmFwcC5jb250cm9sbGVyKCd1cGxvYWRzJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuVXBsb2FkcyA9IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgY29udHJvbGxlcjogdXBsb2FkRmlsZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy91cGxvYWQvdXBsb2FkLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiB1cGxvYWRGaWxlKCRzY29wZSwgJG1kRGlhbG9nKXtcbiAgICAgICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
