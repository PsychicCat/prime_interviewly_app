var app = angular.module('app', ['ngMaterial', 'ngRoute', 'ui.grid', 'ui.grid.edit', 'ui.grid.rowEdit', 'ui.grid.exporter']);
app.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider){
    $locationProvider.html5Mode({
        enabled: true
    });
    $routeProvider.
        when('/home', {
            templateUrl: 'views/partials/home.html'
        }).

        when('/', {
            templateUrl: 'views/partials/login/login.html'
        }).
        when('/forgot', {
            templateUrl: 'views/partials/forgot/forgot.html'
        }).
        when('/events', {
            templateUrl: 'views/partials/events/events.html'
        }).
        when('/students', {
            templateUrl: 'views/partials/students/students.html'
        }).
        when('/interviewers', {
            templateUrl: 'views/partials/interviewers/interviewers.html'
        }).

        when('/archived-events', {
            templateUrl: 'views/partials/archived-events/archived-events.html'
        }).

        when('/profile', {
            templateUrl: 'views/partials/profile/profile.html'
        }).

        when('/logout', {
            templateUrl: 'views/partials/logout/logout.html'
        }).

        when('/new-event', {
            templateUrl: 'views/partials/new-event/new-event.html'
        }).
        when('/:token', {
            templateUrl: 'views/partials/reset/reset.html',
            controller: 'reset'
        }).
        otherwise({
            redirectTo: '/views/partials/login.html'
    })
}]);
//Student Dialog Controller
app.controller('student', ['$scope', '$mdDialog', function($scope,$mdDialog){
    $scope.openStudents = function(ev){
        $mdDialog.show({
            controller: addStudent,
            templateUrl: 'views/partials/dialogs/student.dialog.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addStudent($scope) {
        $scope.close = function () {
            $mdDialog.hide();
            $scope.companies = [
                {name: 'Prime'},
                {name: 'Nerdery'},
                {name: 'Digital People'}
            ];
            $scope.events = [
                {name: 'mocks Delta'},
                {name: 'career Delta'},
                {name: 'mocks Epsilon'}
            ];
        }
    }

}]);
//Interviewer Dialog Controller
app.controller('interviewer', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openInterviewer = function(ev){
        $mdDialog.show({
            controller: 'addInterviewer',
            templateUrl: 'views/partials/dialogs/interviewer.dialog.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function addInterviewer($scope, $mdDialog){
    $scope.close = function(){
        $mdDialog.hide();
    };
    $scope.cohorts = [
        {name: 'Delta'},
        {name: 'gamma'},
        {name: 'Epsilon'}
    ];
    $scope.events = [
        {name: 'mocks Delta'},
        {name: 'career Delta'},
        {name: 'mocks Epsilon'}
    ]
    }
}]);
//Upload Dialog controller
app.controller('uploads', ['$scope', '$mdDialog', function($scope, $mdDialog){
    $scope.openUploads = function(ev){
        $mdDialog.show({
            controller: uploadFile,
            templateUrl: 'views/partials/dialogs/upload.dialog.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function uploadFile($scope, $mdDialog){
        $scope.close = function() {
            $mdDialog.hide();
        }
    }
}]);
//controller for the registration also sends post to create a user
app.controller('registerOpen', ['$scope', '$mdDialog', '$http', function($scope, $mdDialog){
    $scope.openRegister = function(ev){
        $mdDialog.show({
            controller: register,
            templateUrl: 'views/partials/dialogs/register.dialog.html',
            parent: angular.element(document.body),
            targetEvent: ev,
            clickOutsideToClose: true
        })
    };
    function register($scope, $http, $mdDialog) {
        $scope.register = function(username, email, password){
            $http.post('/api/users', {
                username: username,
                email: email,
                password: password
            }).then(function(response){
                console.log(response);
                if(response == 200) {
                    $mdDialog.hide()
                }
            });
        };
        $scope.close = function(){
            $mdDialog.hide();
        };
    }
}]);
//controller to send reset email
app.controller('sendEmail', ['$scope', '$http', '$location', function($scope, $http, $location){
    $scope.send = function(email) {
        $http.post('/forgot', {email: email}).then(function (response) {
            if (response.status == 200) {
                $location.path('/')
            }
        })
    }
}]);
//controller to send password to authentication and login to website on confirmation
app.controller('login', ['$rootScope','$scope', '$http', '$location', '$mdToast', function($rootScope, $scope, $http, $location, $mdToast){
    $scope.submit = function(username, password){
        $http.post('/authenticate', {username: username, password: password}).then(function(response){
                if(response.data.token){
                    sessionStorage.username = angular.toJson(response.data.user.username);
                    sessionStorage.email = angular.toJson(response.data.user.email);
                    sessionStorage.token = angular.toJson(response.data.token);
                    $location.path('/events');
                    $rootScope.$broadcast('logged In')
                }else{
                    $mdToast.showSimple(response.data.error)
                }

            }

        )
    }
}]);
//controller for main toolbar
app.controller('toolbar', ['$rootScope','$scope', '$window', function($rootScope, $scope, $window){
    $scope.user = $window.sessionStorage;
    $scope.paths = true;
    $rootScope.$on('logged In', function(){
        if($window.sessionStorage.token == undefined){
            $scope.paths = true;
        }else{
            $scope.paths = false;
        }
    })

}]);
app.controller('reset',['$scope', '$http', '$routeParams', '$location', function($scope, $http, $routeParams, $location){
    $scope.changePass = function(password, confirm){
        console.log(password);
        var token = $routeParams.token;
        if(password === confirm){
            $http.post('/reset', {password: password, token: token}).then(function(response){
                console.log(response);
                if(response.status === 200){
                    $location.path('/');
                }
            })
        }
    }
}]);
//controller for the logout functionality
app.controller('logout', ['$rootScope', '$scope','$location', '$interval', function($rootScope, $scope, $location, $interval){
    $scope.logout = function(){
        $location.path('/logout');
        sessionStorage.clear();
        $rootScope.$broadcast('logged In');
        $interval(function() {
            $location.path('/')
        }, 3000, 1)
    };
}]);
//directive to check the passwords are the same
app.directive('verifySame', function(){
       return {
           require: "ngModel",
           scope: {
               otherModelValue: "=compareTo"
           },
           link: function(scope, element, attributes, ngModel) {

               ngModel.$validators.compareTo = function(modelValue) {
                   return modelValue == scope.otherModelValue;
               };

               scope.$watch("password", function() {
                   ngModel.$validate();
               });
           }
       };
});

app.controller('generateCtrl', ['$scope', '$http', function($scope, $http) {

    // time experiments
    var startTime = moment('1:00 PM', 'h:mm A').format('HH:mm');
    var endTime = moment('4:00 PM', 'h:mm A').format('HH:mm');
    var eventLength = moment(endTime, 'HH:mm').diff(moment(startTime, 'HH:mm'), 'minutes');
    var slotLength = moment.duration((eventLength / 9), 'minutes').asMinutes();
    console.log(moment(startTime, 'HH:mm').add((slotLength * 8), 'minutes').format('h:mm A'));

    // Initialize UI Grid variables
    var gridCols = [];
    var gridData = [];

    // UI Grid options
    $scope.gridOptions = {
        enableSorting: false,
        enableGridMenu: true,
        enableFiltering: false,
        onRegisterApi: function (gridApi) {
            $scope.gridApi = gridApi;
        }
    };

    // "Generate" button click function
    $scope.generate = function () {

        // request matches from server given event settings
        $http({
            method: 'GET',
            url: 'http://localhost:3000/test'
        }).then(function successCallback(response) {

            // empty the UI Grid variables in case there is data
            $scope.gridOptions.columnDefs = [];
            $scope.gridOptions.data = [];
            gridCols = [];
            gridData = [];

            // console log API response for debugging
            console.log(response);

            // iterate over the interviewer array within the response
            // create various arrays and objects to meet UI Grid data requirements
            response.data.interviewer.forEach(function(item, pos) {

                // push the company and interviewer name into the column names array
                // this will be the column header for a particular interviewer
                gridCols.push({name: item.company + ' / ' + item.fName, field: item.company + '_' + item.name, width:150, displayName: item.company + ' / ' + item.fName});

                // set the scheduled object to a variable
                // this object contains the entire schedule for an interviewer
                var sched = item.scheduled;

                // initiate an empty students array
                // this will be used to store the formatted schedule for each company
                var students = [];

                // iterate over the scheduled object using the getOwnPropertyNames method
                Object.getOwnPropertyNames(sched).forEach(function (elem, index, array) {
                    // create an array of objects that contains each scheduled item
                    // this array will contain the formatted schedule for an interviewer
                    students.push({[item.company + '_' + item.fname]: sched[elem]});
            });

            // push the updated schedule array into the master gridData array
            gridData.push(students);
            });

            // gridData is still not correctly formatted
            // each item represents an interviewer column
            // when in fact, UI Grid requires each item in the array to be a row of data
            // Underscore unzip function performs necessary matrix transformation
            gridData = _.unzip(gridData);

            // initiate empty array to store each row as an object of objects
            var gridArr = [];

            // iterate over unzipped gridData
            gridData.forEach(function (item, pos) {

                // initiate empty object for storing individual schedule items
                var rowObj = {};

                // iterate over the schedule row
                // each item in the row array represents a single cell in the grid
                item.forEach(function (elem, index) {
                    // use Underscore extend method to "push" each item into row object
                    _.extend(rowObj, elem);
                });

                // push the row object into the previously initiated grid array
                gridArr.push(rowObj);
            });

            // initiate an empty object for storing the entire schedule
            gridObj = {};

            // create time slots column
            var timeSlots = [];
            var slotsSize = gridArr.length;
            while(slotsSize--) {
                timeSlots.push({time: 'Slot ' + ((gridArr.length) - slotsSize)});
            }

            console.log(timeSlots);

            // using Underscore extend again, "push" the array of objects into the master object
            _.extend(gridObj, gridArr);

            // update the gridData variable
            gridData = gridArr;
        }).then(function() {

            // after capturing and formatting the data, update UI Grid options
            $scope.gridOptions.columnDefs = gridCols;
            $scope.gridOptions.data = gridData;
        })
    };
}]);
angular.module('app').controller('eventsCtrl', function($scope) {
        this.tiles = buildGridModel({
            title: "Event Title",
            background: ""
        });
        function buildGridModel(tileTmpl){
            var it, results = [ ];
                it = angular.extend({},tileTmpl);
                it.title = it.title;
                it.span  = { row : 1, col : 1 };
                it.background = "gray";
                it.span.row = it.span.col = 1;

                results.push(it);

            return results;
        }
    });






//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFyY2hpdmVkLWV2ZW50cy9hcmNoaXZlZC1ldmVudHMuY29udHJvbGxlci5qcyIsImV2ZW50L2V2ZW50LmNvbnRyb2xsZXIuanMiLCJldmVudHMvZXZlbnRzLmNvbnRyb2xsZXIuanMiLCJpbnRlcnZpZXdlcnMvaW50ZXJ2aWV3ZXJzLmNvbnRyb2xsZXIuanMiLCJsb2dvdXQvbG9nb3V0LmNvbnRyb2xsZXIuanMiLCJuZXctZXZlbnQvbmV3LWV2ZW50LmNvbnRyb2xsZXIuanMiLCJwcm9maWxlL3Byb2ZpbGUuY29udHJvbGxlci5qcyIsInN0dWRlbnRzL3N0dWRlbnRzLmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNPQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUNBQTtBQ0FBO0FDQUE7QUNBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICd1aS5ncmlkJywgJ3VpLmdyaWQuZWRpdCcsICd1aS5ncmlkLnJvd0VkaXQnLCAndWkuZ3JpZC5leHBvcnRlciddKTtcbmFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHtcbiAgICAgICAgZW5hYmxlZDogdHJ1ZVxuICAgIH0pO1xuICAgICRyb3V0ZVByb3ZpZGVyLlxuICAgICAgICB3aGVuKCcvaG9tZScsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvaG9tZS5odG1sJ1xuICAgICAgICB9KS5cblxuICAgICAgICB3aGVuKCcvJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9sb2dpbi9sb2dpbi5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2ZvcmdvdCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZm9yZ290L2ZvcmdvdC5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2V2ZW50cycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZXZlbnRzL2V2ZW50cy5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL3N0dWRlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9zdHVkZW50cy9zdHVkZW50cy5odG1sJ1xuICAgICAgICB9KS5cbiAgICAgICAgd2hlbignL2ludGVydmlld2VycycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvaW50ZXJ2aWV3ZXJzL2ludGVydmlld2Vycy5odG1sJ1xuICAgICAgICB9KS5cblxuICAgICAgICB3aGVuKCcvYXJjaGl2ZWQtZXZlbnRzJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9hcmNoaXZlZC1ldmVudHMvYXJjaGl2ZWQtZXZlbnRzLmh0bWwnXG4gICAgICAgIH0pLlxuXG4gICAgICAgIHdoZW4oJy9wcm9maWxlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9wcm9maWxlL3Byb2ZpbGUuaHRtbCdcbiAgICAgICAgfSkuXG5cbiAgICAgICAgd2hlbignL2xvZ291dCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvbG9nb3V0L2xvZ291dC5odG1sJ1xuICAgICAgICB9KS5cblxuICAgICAgICB3aGVuKCcvbmV3LWV2ZW50Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9uZXctZXZlbnQvbmV3LWV2ZW50Lmh0bWwnXG4gICAgICAgIH0pLlxuICAgICAgICB3aGVuKCcvOnRva2VuJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9yZXNldC9yZXNldC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZXNldCdcbiAgICAgICAgfSkuXG4gICAgICAgIG90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLmh0bWwnXG4gICAgfSlcbn1dKTtcbi8vU3R1ZGVudCBEaWFsb2cgQ29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ3N0dWRlbnQnLCBbJyRzY29wZScsICckbWREaWFsb2cnLCBmdW5jdGlvbigkc2NvcGUsJG1kRGlhbG9nKXtcbiAgICAkc2NvcGUub3BlblN0dWRlbnRzID0gZnVuY3Rpb24oZXYpe1xuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICBjb250cm9sbGVyOiBhZGRTdHVkZW50LFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL3N0dWRlbnQuZGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiBhZGRTdHVkZW50KCRzY29wZSkge1xuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmllcyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ1ByaW1lJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdOZXJkZXJ5J30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdEaWdpdGFsIFBlb3BsZSd9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgJHNjb3BlLmV2ZW50cyA9IFtcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIERlbHRhJ30sXG4gICAgICAgICAgICAgICAge25hbWU6ICdjYXJlZXIgRGVsdGEnfSxcbiAgICAgICAgICAgICAgICB7bmFtZTogJ21vY2tzIEVwc2lsb24nfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH1cblxufV0pO1xuLy9JbnRlcnZpZXdlciBEaWFsb2cgQ29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ2ludGVydmlld2VyJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuSW50ZXJ2aWV3ZXIgPSBmdW5jdGlvbihldil7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhZGRJbnRlcnZpZXdlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3BhcnRpYWxzL2RpYWxvZ3MvaW50ZXJ2aWV3ZXIuZGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiBhZGRJbnRlcnZpZXdlcigkc2NvcGUsICRtZERpYWxvZyl7XG4gICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcbiAgICB9O1xuICAgICRzY29wZS5jb2hvcnRzID0gW1xuICAgICAgICB7bmFtZTogJ0RlbHRhJ30sXG4gICAgICAgIHtuYW1lOiAnZ2FtbWEnfSxcbiAgICAgICAge25hbWU6ICdFcHNpbG9uJ31cbiAgICBdO1xuICAgICRzY29wZS5ldmVudHMgPSBbXG4gICAgICAgIHtuYW1lOiAnbW9ja3MgRGVsdGEnfSxcbiAgICAgICAge25hbWU6ICdjYXJlZXIgRGVsdGEnfSxcbiAgICAgICAge25hbWU6ICdtb2NrcyBFcHNpbG9uJ31cbiAgICBdXG4gICAgfVxufV0pO1xuLy9VcGxvYWQgRGlhbG9nIGNvbnRyb2xsZXJcbmFwcC5jb250cm9sbGVyKCd1cGxvYWRzJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuVXBsb2FkcyA9IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgY29udHJvbGxlcjogdXBsb2FkRmlsZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcGFydGlhbHMvZGlhbG9ncy91cGxvYWQuZGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgfTtcbiAgICBmdW5jdGlvbiB1cGxvYWRGaWxlKCRzY29wZSwgJG1kRGlhbG9nKXtcbiAgICAgICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxufV0pO1xuLy9jb250cm9sbGVyIGZvciB0aGUgcmVnaXN0cmF0aW9uIGFsc28gc2VuZHMgcG9zdCB0byBjcmVhdGUgYSB1c2VyXG5hcHAuY29udHJvbGxlcigncmVnaXN0ZXJPcGVuJywgWyckc2NvcGUnLCAnJG1kRGlhbG9nJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCAkbWREaWFsb2cpe1xuICAgICRzY29wZS5vcGVuUmVnaXN0ZXIgPSBmdW5jdGlvbihldil7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IHJlZ2lzdGVyLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9wYXJ0aWFscy9kaWFsb2dzL3JlZ2lzdGVyLmRpYWxvZy5odG1sJyxcbiAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxuICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZVxuICAgICAgICB9KVxuICAgIH07XG4gICAgZnVuY3Rpb24gcmVnaXN0ZXIoJHNjb3BlLCAkaHR0cCwgJG1kRGlhbG9nKSB7XG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQpe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9O1xuICAgIH1cbn1dKTtcbi8vY29udHJvbGxlciB0byBzZW5kIHJlc2V0IGVtYWlsXG5hcHAuY29udHJvbGxlcignc2VuZEVtYWlsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUuc2VuZCA9IGZ1bmN0aW9uKGVtYWlsKSB7XG4gICAgICAgICRodHRwLnBvc3QoJy9mb3Jnb3QnLCB7ZW1haWw6IGVtYWlsfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cbn1dKTtcbi8vY29udHJvbGxlciB0byBzZW5kIHBhc3N3b3JkIHRvIGF1dGhlbnRpY2F0aW9uIGFuZCBsb2dpbiB0byB3ZWJzaXRlIG9uIGNvbmZpcm1hdGlvblxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luJywgWyckcm9vdFNjb3BlJywnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICckbWRUb2FzdCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgJG1kVG9hc3Qpe1xuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXV0aGVudGljYXRlJywge3VzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS50b2tlbil7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnVzZXJuYW1lID0gYW5ndWxhci50b0pzb24ocmVzcG9uc2UuZGF0YS51c2VyLnVzZXJuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UuZW1haWwgPSBhbmd1bGFyLnRvSnNvbihyZXNwb25zZS5kYXRhLnVzZXIuZW1haWwpO1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS50b2tlbiA9IGFuZ3VsYXIudG9Kc29uKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50cycpO1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZCBJbicpXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICRtZFRvYXN0LnNob3dTaW1wbGUocmVzcG9uc2UuZGF0YS5lcnJvcilcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICApXG4gICAgfVxufV0pO1xuLy9jb250cm9sbGVyIGZvciBtYWluIHRvb2xiYXJcbmFwcC5jb250cm9sbGVyKCd0b29sYmFyJywgWyckcm9vdFNjb3BlJywnJHNjb3BlJywgJyR3aW5kb3cnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICR3aW5kb3cpe1xuICAgICRzY29wZS51c2VyID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcbiAgICAkc2NvcGUucGF0aHMgPSB0cnVlO1xuICAgICRyb290U2NvcGUuJG9uKCdsb2dnZWQgSW4nLCBmdW5jdGlvbigpe1xuICAgICAgICBpZigkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuID09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAkc2NvcGUucGF0aHMgPSB0cnVlO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICRzY29wZS5wYXRocyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSlcblxufV0pO1xuYXBwLmNvbnRyb2xsZXIoJ3Jlc2V0JyxbJyRzY29wZScsICckaHR0cCcsICckcm91dGVQYXJhbXMnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS5jaGFuZ2VQYXNzID0gZnVuY3Rpb24ocGFzc3dvcmQsIGNvbmZpcm0pe1xuICAgICAgICBjb25zb2xlLmxvZyhwYXNzd29yZCk7XG4gICAgICAgIHZhciB0b2tlbiA9ICRyb3V0ZVBhcmFtcy50b2tlbjtcbiAgICAgICAgaWYocGFzc3dvcmQgPT09IGNvbmZpcm0pe1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3Jlc2V0Jywge3Bhc3N3b3JkOiBwYXNzd29yZCwgdG9rZW46IHRva2VufSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxufV0pO1xuLy9jb250cm9sbGVyIGZvciB0aGUgbG9nb3V0IGZ1bmN0aW9uYWxpdHlcbmFwcC5jb250cm9sbGVyKCdsb2dvdXQnLCBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywnJGxvY2F0aW9uJywgJyRpbnRlcnZhbCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkaW50ZXJ2YWwpe1xuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ291dCcpO1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5jbGVhcigpO1xuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZCBJbicpO1xuICAgICAgICAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXG4gICAgICAgIH0sIDMwMDAsIDEpXG4gICAgfTtcbn1dKTtcbi8vZGlyZWN0aXZlIHRvIGNoZWNrIHRoZSBwYXNzd29yZHMgYXJlIHRoZSBzYW1lXG5hcHAuZGlyZWN0aXZlKCd2ZXJpZnlTYW1lJywgZnVuY3Rpb24oKXtcbiAgICAgICByZXR1cm4ge1xuICAgICAgICAgICByZXF1aXJlOiBcIm5nTW9kZWxcIixcbiAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgIG90aGVyTW9kZWxWYWx1ZTogXCI9Y29tcGFyZVRvXCJcbiAgICAgICAgICAgfSxcbiAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMsIG5nTW9kZWwpIHtcblxuICAgICAgICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5jb21wYXJlVG8gPSBmdW5jdGlvbihtb2RlbFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsVmFsdWUgPT0gc2NvcGUub3RoZXJNb2RlbFZhbHVlO1xuICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwicGFzc3dvcmRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICB9XG4gICAgICAgfTtcbn0pOyIsIiIsImFwcC5jb250cm9sbGVyKCdnZW5lcmF0ZUN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcblxuICAgIC8vIHRpbWUgZXhwZXJpbWVudHNcbiAgICB2YXIgc3RhcnRUaW1lID0gbW9tZW50KCcxOjAwIFBNJywgJ2g6bW0gQScpLmZvcm1hdCgnSEg6bW0nKTtcbiAgICB2YXIgZW5kVGltZSA9IG1vbWVudCgnNDowMCBQTScsICdoOm1tIEEnKS5mb3JtYXQoJ0hIOm1tJyk7XG4gICAgdmFyIGV2ZW50TGVuZ3RoID0gbW9tZW50KGVuZFRpbWUsICdISDptbScpLmRpZmYobW9tZW50KHN0YXJ0VGltZSwgJ0hIOm1tJyksICdtaW51dGVzJyk7XG4gICAgdmFyIHNsb3RMZW5ndGggPSBtb21lbnQuZHVyYXRpb24oKGV2ZW50TGVuZ3RoIC8gOSksICdtaW51dGVzJykuYXNNaW51dGVzKCk7XG4gICAgY29uc29sZS5sb2cobW9tZW50KHN0YXJ0VGltZSwgJ0hIOm1tJykuYWRkKChzbG90TGVuZ3RoICogOCksICdtaW51dGVzJykuZm9ybWF0KCdoOm1tIEEnKSk7XG5cbiAgICAvLyBJbml0aWFsaXplIFVJIEdyaWQgdmFyaWFibGVzXG4gICAgdmFyIGdyaWRDb2xzID0gW107XG4gICAgdmFyIGdyaWREYXRhID0gW107XG5cbiAgICAvLyBVSSBHcmlkIG9wdGlvbnNcbiAgICAkc2NvcGUuZ3JpZE9wdGlvbnMgPSB7XG4gICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICBlbmFibGVHcmlkTWVudTogdHJ1ZSxcbiAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgb25SZWdpc3RlckFwaTogZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBcIkdlbmVyYXRlXCIgYnV0dG9uIGNsaWNrIGZ1bmN0aW9uXG4gICAgJHNjb3BlLmdlbmVyYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIC8vIHJlcXVlc3QgbWF0Y2hlcyBmcm9tIHNlcnZlciBnaXZlbiBldmVudCBzZXR0aW5nc1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL3Rlc3QnXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIC8vIGVtcHR5IHRoZSBVSSBHcmlkIHZhcmlhYmxlcyBpbiBjYXNlIHRoZXJlIGlzIGRhdGFcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gW107XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICAgICAgZ3JpZENvbHMgPSBbXTtcbiAgICAgICAgICAgIGdyaWREYXRhID0gW107XG5cbiAgICAgICAgICAgIC8vIGNvbnNvbGUgbG9nIEFQSSByZXNwb25zZSBmb3IgZGVidWdnaW5nXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cbiAgICAgICAgICAgIC8vIGl0ZXJhdGUgb3ZlciB0aGUgaW50ZXJ2aWV3ZXIgYXJyYXkgd2l0aGluIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgLy8gY3JlYXRlIHZhcmlvdXMgYXJyYXlzIGFuZCBvYmplY3RzIHRvIG1lZXQgVUkgR3JpZCBkYXRhIHJlcXVpcmVtZW50c1xuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pbnRlcnZpZXdlci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIHBvcykge1xuXG4gICAgICAgICAgICAgICAgLy8gcHVzaCB0aGUgY29tcGFueSBhbmQgaW50ZXJ2aWV3ZXIgbmFtZSBpbnRvIHRoZSBjb2x1bW4gbmFtZXMgYXJyYXlcbiAgICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgYmUgdGhlIGNvbHVtbiBoZWFkZXIgZm9yIGEgcGFydGljdWxhciBpbnRlcnZpZXdlclxuICAgICAgICAgICAgICAgIGdyaWRDb2xzLnB1c2goe25hbWU6IGl0ZW0uY29tcGFueSArICcgLyAnICsgaXRlbS5mTmFtZSwgZmllbGQ6IGl0ZW0uY29tcGFueSArICdfJyArIGl0ZW0ubmFtZSwgd2lkdGg6MTUwLCBkaXNwbGF5TmFtZTogaXRlbS5jb21wYW55ICsgJyAvICcgKyBpdGVtLmZOYW1lfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHNjaGVkdWxlZCBvYmplY3QgdG8gYSB2YXJpYWJsZVxuICAgICAgICAgICAgICAgIC8vIHRoaXMgb2JqZWN0IGNvbnRhaW5zIHRoZSBlbnRpcmUgc2NoZWR1bGUgZm9yIGFuIGludGVydmlld2VyXG4gICAgICAgICAgICAgICAgdmFyIHNjaGVkID0gaXRlbS5zY2hlZHVsZWQ7XG5cbiAgICAgICAgICAgICAgICAvLyBpbml0aWF0ZSBhbiBlbXB0eSBzdHVkZW50cyBhcnJheVxuICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBiZSB1c2VkIHRvIHN0b3JlIHRoZSBmb3JtYXR0ZWQgc2NoZWR1bGUgZm9yIGVhY2ggY29tcGFueVxuICAgICAgICAgICAgICAgIHZhciBzdHVkZW50cyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBzY2hlZHVsZWQgb2JqZWN0IHVzaW5nIHRoZSBnZXRPd25Qcm9wZXJ0eU5hbWVzIG1ldGhvZFxuICAgICAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHNjaGVkKS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtLCBpbmRleCwgYXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGFuIGFycmF5IG9mIG9iamVjdHMgdGhhdCBjb250YWlucyBlYWNoIHNjaGVkdWxlZCBpdGVtXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgYXJyYXkgd2lsbCBjb250YWluIHRoZSBmb3JtYXR0ZWQgc2NoZWR1bGUgZm9yIGFuIGludGVydmlld2VyXG4gICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzLnB1c2goe1tpdGVtLmNvbXBhbnkgKyAnXycgKyBpdGVtLmZuYW1lXTogc2NoZWRbZWxlbV19KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBwdXNoIHRoZSB1cGRhdGVkIHNjaGVkdWxlIGFycmF5IGludG8gdGhlIG1hc3RlciBncmlkRGF0YSBhcnJheVxuICAgICAgICAgICAgZ3JpZERhdGEucHVzaChzdHVkZW50cyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gZ3JpZERhdGEgaXMgc3RpbGwgbm90IGNvcnJlY3RseSBmb3JtYXR0ZWRcbiAgICAgICAgICAgIC8vIGVhY2ggaXRlbSByZXByZXNlbnRzIGFuIGludGVydmlld2VyIGNvbHVtblxuICAgICAgICAgICAgLy8gd2hlbiBpbiBmYWN0LCBVSSBHcmlkIHJlcXVpcmVzIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkgdG8gYmUgYSByb3cgb2YgZGF0YVxuICAgICAgICAgICAgLy8gVW5kZXJzY29yZSB1bnppcCBmdW5jdGlvbiBwZXJmb3JtcyBuZWNlc3NhcnkgbWF0cml4IHRyYW5zZm9ybWF0aW9uXG4gICAgICAgICAgICBncmlkRGF0YSA9IF8udW56aXAoZ3JpZERhdGEpO1xuXG4gICAgICAgICAgICAvLyBpbml0aWF0ZSBlbXB0eSBhcnJheSB0byBzdG9yZSBlYWNoIHJvdyBhcyBhbiBvYmplY3Qgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgdmFyIGdyaWRBcnIgPSBbXTtcblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHVuemlwcGVkIGdyaWREYXRhXG4gICAgICAgICAgICBncmlkRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBwb3MpIHtcblxuICAgICAgICAgICAgICAgIC8vIGluaXRpYXRlIGVtcHR5IG9iamVjdCBmb3Igc3RvcmluZyBpbmRpdmlkdWFsIHNjaGVkdWxlIGl0ZW1zXG4gICAgICAgICAgICAgICAgdmFyIHJvd09iaiA9IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBzY2hlZHVsZSByb3dcbiAgICAgICAgICAgICAgICAvLyBlYWNoIGl0ZW0gaW4gdGhlIHJvdyBhcnJheSByZXByZXNlbnRzIGEgc2luZ2xlIGNlbGwgaW4gdGhlIGdyaWRcbiAgICAgICAgICAgICAgICBpdGVtLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZSBVbmRlcnNjb3JlIGV4dGVuZCBtZXRob2QgdG8gXCJwdXNoXCIgZWFjaCBpdGVtIGludG8gcm93IG9iamVjdFxuICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZChyb3dPYmosIGVsZW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gcHVzaCB0aGUgcm93IG9iamVjdCBpbnRvIHRoZSBwcmV2aW91c2x5IGluaXRpYXRlZCBncmlkIGFycmF5XG4gICAgICAgICAgICAgICAgZ3JpZEFyci5wdXNoKHJvd09iaik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaW5pdGlhdGUgYW4gZW1wdHkgb2JqZWN0IGZvciBzdG9yaW5nIHRoZSBlbnRpcmUgc2NoZWR1bGVcbiAgICAgICAgICAgIGdyaWRPYmogPSB7fTtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIHRpbWUgc2xvdHMgY29sdW1uXG4gICAgICAgICAgICB2YXIgdGltZVNsb3RzID0gW107XG4gICAgICAgICAgICB2YXIgc2xvdHNTaXplID0gZ3JpZEFyci5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZShzbG90c1NpemUtLSkge1xuICAgICAgICAgICAgICAgIHRpbWVTbG90cy5wdXNoKHt0aW1lOiAnU2xvdCAnICsgKChncmlkQXJyLmxlbmd0aCkgLSBzbG90c1NpemUpfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRpbWVTbG90cyk7XG5cbiAgICAgICAgICAgIC8vIHVzaW5nIFVuZGVyc2NvcmUgZXh0ZW5kIGFnYWluLCBcInB1c2hcIiB0aGUgYXJyYXkgb2Ygb2JqZWN0cyBpbnRvIHRoZSBtYXN0ZXIgb2JqZWN0XG4gICAgICAgICAgICBfLmV4dGVuZChncmlkT2JqLCBncmlkQXJyKTtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBncmlkRGF0YSB2YXJpYWJsZVxuICAgICAgICAgICAgZ3JpZERhdGEgPSBncmlkQXJyO1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBhZnRlciBjYXB0dXJpbmcgYW5kIGZvcm1hdHRpbmcgdGhlIGRhdGEsIHVwZGF0ZSBVSSBHcmlkIG9wdGlvbnNcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZENvbHM7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IGdyaWREYXRhO1xuICAgICAgICB9KVxuICAgIH07XG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ2V2ZW50c0N0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcbiAgICAgICAgdGhpcy50aWxlcyA9IGJ1aWxkR3JpZE1vZGVsKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkV2ZW50IFRpdGxlXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiBcIlwiXG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBidWlsZEdyaWRNb2RlbCh0aWxlVG1wbCl7XG4gICAgICAgICAgICB2YXIgaXQsIHJlc3VsdHMgPSBbIF07XG4gICAgICAgICAgICAgICAgaXQgPSBhbmd1bGFyLmV4dGVuZCh7fSx0aWxlVG1wbCk7XG4gICAgICAgICAgICAgICAgaXQudGl0bGUgPSBpdC50aXRsZTtcbiAgICAgICAgICAgICAgICBpdC5zcGFuICA9IHsgcm93IDogMSwgY29sIDogMSB9O1xuICAgICAgICAgICAgICAgIGl0LmJhY2tncm91bmQgPSBcImdyYXlcIjtcbiAgICAgICAgICAgICAgICBpdC5zcGFuLnJvdyA9IGl0LnNwYW4uY29sID0gMTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChpdCk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9XG4gICAgfSk7XG4iLCIiLCIiLCIiLCIiLCIiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
